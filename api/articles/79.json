{"title":"Oracle数据库小结","slug":"79","date":"2021-01-17T08:10:25.000Z","updated":"2021-01-17T08:10:25.000Z","comments":true,"path":"api/articles/79.json","realPath":null,"excerpt":"最近在维护一个oracle数据库的项目，本文把遇到的一些问题做了一个小结。","covers":null,"cover":null,"content":"<p>最近在维护一个oracle数据库的项目，本文把遇到的一些问题做了一个小结。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"运行环境\"><a href=\"#运行环境\" class=\"headerlink\" title=\"运行环境\"></a>运行环境</h2><p>OS: win server 2016</p>\n<p>Oracle:11g</p>\n<h2 id=\"数据库连接问题\"><a href=\"#数据库连接问题\" class=\"headerlink\" title=\"数据库连接问题\"></a>数据库连接问题</h2><p>Oracle数据库与其它数据库（如mysql、sql server等）最大的区别可能就是必须要安装oracle客户端，通过其Net Manager配置网络服务名。但如果是Java则可以使用thin进行连接，而不需要安装oracle客户端。[1]</p>\n<h2 id=\"表空间-tablespace\"><a href=\"#表空间-tablespace\" class=\"headerlink\" title=\"表空间(tablespace)\"></a>表空间(tablespace)</h2><p>Oracle数据库被划分成称作表空间的逻辑区域，形成Oracle数据库的逻辑结构，类似与其他关系型数据的database的概念，用来存储如表、视图、索引等信息。一个数据库实例可以有多个表空间，一个表空间可以有多个数据文件，一个数据文件的最大大小32GB,当超过32G时，需要为表空间添加数据文件。</p>\n<p>注：关于对表空间的相关操作可以通过Toad来进行。</p>\n<h3 id=\"创建表空间\"><a href=\"#创建表空间\" class=\"headerlink\" title=\"创建表空间\"></a>创建表空间</h3><p>这里创建了一个大小200M的、可自动扩展的、最大大小没有限制(32G)的表空间：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">create tablespace GMAP datafile &#39;D:\\xx\\xx.dbf&#39; size 200M AUTOEXTEND ON NEXT 5M MAXSIZE UNLIMITED;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"新增数据文件\"><a href=\"#新增数据文件\" class=\"headerlink\" title=\"新增数据文件\"></a>新增数据文件</h3><p>当表空间的数据文件达到32G时，表空间的大小无法自动增加，可以通过新增数据文件的方式继续向表空间中写入数据。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">ALTER TABLESPACE app_data ADD DATAFILE\n&#39;D:\\xx.DBF&#39; SIZE 50M\nAUTOEXTEND ON NEXT 5M MAXSIZE 100M; <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"临时表空间\"><a href=\"#临时表空间\" class=\"headerlink\" title=\"临时表空间\"></a>临时表空间</h2><p>临时表空间用来管理数据库排序操作以及用于存储临时表、中间排序结果等临时对象,当ORACLE里需要用到SORT的时候，并且当PGA中sort_area_size大小不够时，将会把数据放入临时表空间里进行排序。像数据库中一些操作： CREATE INDEX、 ANALYZE、SELECT DISTINCT、ORDER BY、GROUP BY、 UNION ALL、 INTERSECT、MINUS、SORT-MERGE JOINS、HASH JOIN等都可能会用到临时表空间。当操作完成后，系统会自动清理临时表空间中的临时对象，自动释放临时段。这里的释放只是标记为空闲、可以重用，其实实质占用的磁盘空间并没有真正释放。这也是临时表空间有时会不断增大的原因。[2]</p>\n<p>当我们进行部分查询或者创建索引的时候，会遇到ora-01652无法通过128(在表空间temp中)扩展temp段的错误，这个就是提示我们临时表空间爆了，可以通过更换临时表空间解决。</p>\n<h3 id=\"创建临时表空间\"><a href=\"#创建临时表空间\" class=\"headerlink\" title=\"创建临时表空间\"></a>创建临时表空间</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">create temporary tablespace temp02 tempfile &#39;E:\\xxx.DBF&#39; size 1024M autoextend on;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"修改默认临时表空间\"><a href=\"#修改默认临时表空间\" class=\"headerlink\" title=\"修改默认临时表空间\"></a>修改默认临时表空间</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">-- 查看临时表空间\nSELECT USERNAME,TEMPORARY_TABLESPACE FROM DBA_USERS;\n-- 更换临时表空间\nalter database default temporary tablespace temp02;\n-- 删除旧的临时表空间\ndrop tablespace temp including contents and datafiles;\n-- 确认是否删除\nselect tablespace_name from dba_tablespaces; <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"管理员账户无法登陆\"><a href=\"#管理员账户无法登陆\" class=\"headerlink\" title=\"管理员账户无法登陆\"></a>管理员账户无法登陆</h2><p>重置密码文件PWDorcl2.ora</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">orapwd file&#x3D;C:\\app\\xx\\product\\11.2.0\\dbhome_1\\database\\PWDorcl2.ora password&#x3D;admin entries&#x3D;40 force&#x3D;y;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>使用dba账户登陆，给用户授权</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sqlplus &#x2F;nolog\nconn sys&#x2F;admin as sysdba<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h2 id=\"监听日志文件达到4G-导致数据库无法连接-4\"><a href=\"#监听日志文件达到4G-导致数据库无法连接-4\" class=\"headerlink\" title=\"监听日志文件达到4G,导致数据库无法连接[4]\"></a>监听日志文件达到4G,导致数据库无法连接[4]</h2><p>listener的日至文件位于：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">app\\Administrator\\diag\\tnslsnr\\pc-name\\listener\\trace\\listener.log<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>当此文件的大小超过4G时，windows下就无法连接了，可通过清空此文件或者关闭监听器日志,命令如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lsnrctl set log_status off      \nlsnrctl set log_status on  <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>清空日志的时候需要关闭日至，即off命令。</p>\n<h2 id=\"数据导入及导出\"><a href=\"#数据导入及导出\" class=\"headerlink\" title=\"数据导入及导出\"></a>数据导入及导出</h2><h3 id=\"导出-exp\"><a href=\"#导出-exp\" class=\"headerlink\" title=\"导出(exp)\"></a>导出(exp)</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">exp user&#x2F;pwd@localhost:1521&#x2F;orcl owner&#x3D;user rows&#x3D;y indexes&#x3D;n compress&#x3D;n buffer&#x3D;500000000 file&#x3D;xx.dmp log&#x3D;xx.log<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"导入\"><a href=\"#导入\" class=\"headerlink\" title=\"导入\"></a>导入</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">imp user&#x2F;pwd@localhost&#x2F;orcl file&#x3D;xx.dmp full&#x3D;y ignore&#x3D;y<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.cnblogs.com/arxive/p/10147641.html\">1、连接ORACLE数据库，是不是必须要安装oracle客户端的运行时</a><br><a href=\"https://www.cnblogs.com/zhangyingai/p/7082594.html\">2、ORACLE临时表空间总结</a><br><a href=\"https://www.cnblogs.com/sunnor/p/7097998.html\">3、关于Oracle使用管理员账号登录失败的问题</a><br><a href=\"http://blog.itpub.net/29578568/viewspace-2140148/\">4、oracle 监听日志文件达到4G，导致监听报错的解决方法 </a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c7474e60\">5、Cover</a></p>\n","more":"<h2 id=\"运行环境\"><a href=\"#运行环境\" class=\"headerlink\" title=\"运行环境\"></a>运行环境</h2><p>OS: win server 2016</p>\n<p>Oracle:11g</p>\n<h2 id=\"数据库连接问题\"><a href=\"#数据库连接问题\" class=\"headerlink\" title=\"数据库连接问题\"></a>数据库连接问题</h2><p>Oracle数据库与其它数据库（如mysql、sql server等）最大的区别可能就是必须要安装oracle客户端，通过其Net Manager配置网络服务名。但如果是Java则可以使用thin进行连接，而不需要安装oracle客户端。[1]</p>\n<h2 id=\"表空间-tablespace\"><a href=\"#表空间-tablespace\" class=\"headerlink\" title=\"表空间(tablespace)\"></a>表空间(tablespace)</h2><p>Oracle数据库被划分成称作表空间的逻辑区域，形成Oracle数据库的逻辑结构，类似与其他关系型数据的database的概念，用来存储如表、视图、索引等信息。一个数据库实例可以有多个表空间，一个表空间可以有多个数据文件，一个数据文件的最大大小32GB,当超过32G时，需要为表空间添加数据文件。</p>\n<p>注：关于对表空间的相关操作可以通过Toad来进行。</p>\n<h3 id=\"创建表空间\"><a href=\"#创建表空间\" class=\"headerlink\" title=\"创建表空间\"></a>创建表空间</h3><p>这里创建了一个大小200M的、可自动扩展的、最大大小没有限制(32G)的表空间：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">create tablespace GMAP datafile &#39;D:\\xx\\xx.dbf&#39; size 200M AUTOEXTEND ON NEXT 5M MAXSIZE UNLIMITED;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"新增数据文件\"><a href=\"#新增数据文件\" class=\"headerlink\" title=\"新增数据文件\"></a>新增数据文件</h3><p>当表空间的数据文件达到32G时，表空间的大小无法自动增加，可以通过新增数据文件的方式继续向表空间中写入数据。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">ALTER TABLESPACE app_data ADD DATAFILE\n&#39;D:\\xx.DBF&#39; SIZE 50M\nAUTOEXTEND ON NEXT 5M MAXSIZE 100M; <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"临时表空间\"><a href=\"#临时表空间\" class=\"headerlink\" title=\"临时表空间\"></a>临时表空间</h2><p>临时表空间用来管理数据库排序操作以及用于存储临时表、中间排序结果等临时对象,当ORACLE里需要用到SORT的时候，并且当PGA中sort_area_size大小不够时，将会把数据放入临时表空间里进行排序。像数据库中一些操作： CREATE INDEX、 ANALYZE、SELECT DISTINCT、ORDER BY、GROUP BY、 UNION ALL、 INTERSECT、MINUS、SORT-MERGE JOINS、HASH JOIN等都可能会用到临时表空间。当操作完成后，系统会自动清理临时表空间中的临时对象，自动释放临时段。这里的释放只是标记为空闲、可以重用，其实实质占用的磁盘空间并没有真正释放。这也是临时表空间有时会不断增大的原因。[2]</p>\n<p>当我们进行部分查询或者创建索引的时候，会遇到ora-01652无法通过128(在表空间temp中)扩展temp段的错误，这个就是提示我们临时表空间爆了，可以通过更换临时表空间解决。</p>\n<h3 id=\"创建临时表空间\"><a href=\"#创建临时表空间\" class=\"headerlink\" title=\"创建临时表空间\"></a>创建临时表空间</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">create temporary tablespace temp02 tempfile &#39;E:\\xxx.DBF&#39; size 1024M autoextend on;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"修改默认临时表空间\"><a href=\"#修改默认临时表空间\" class=\"headerlink\" title=\"修改默认临时表空间\"></a>修改默认临时表空间</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">-- 查看临时表空间\nSELECT USERNAME,TEMPORARY_TABLESPACE FROM DBA_USERS;\n-- 更换临时表空间\nalter database default temporary tablespace temp02;\n-- 删除旧的临时表空间\ndrop tablespace temp including contents and datafiles;\n-- 确认是否删除\nselect tablespace_name from dba_tablespaces; <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"管理员账户无法登陆\"><a href=\"#管理员账户无法登陆\" class=\"headerlink\" title=\"管理员账户无法登陆\"></a>管理员账户无法登陆</h2><p>重置密码文件PWDorcl2.ora</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">orapwd file&#x3D;C:\\app\\xx\\product\\11.2.0\\dbhome_1\\database\\PWDorcl2.ora password&#x3D;admin entries&#x3D;40 force&#x3D;y;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>使用dba账户登陆，给用户授权</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sqlplus &#x2F;nolog\nconn sys&#x2F;admin as sysdba<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h2 id=\"监听日志文件达到4G-导致数据库无法连接-4\"><a href=\"#监听日志文件达到4G-导致数据库无法连接-4\" class=\"headerlink\" title=\"监听日志文件达到4G,导致数据库无法连接[4]\"></a>监听日志文件达到4G,导致数据库无法连接[4]</h2><p>listener的日至文件位于：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">app\\Administrator\\diag\\tnslsnr\\pc-name\\listener\\trace\\listener.log<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>当此文件的大小超过4G时，windows下就无法连接了，可通过清空此文件或者关闭监听器日志,命令如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lsnrctl set log_status off      \nlsnrctl set log_status on  <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>清空日志的时候需要关闭日至，即off命令。</p>\n<h2 id=\"数据导入及导出\"><a href=\"#数据导入及导出\" class=\"headerlink\" title=\"数据导入及导出\"></a>数据导入及导出</h2><h3 id=\"导出-exp\"><a href=\"#导出-exp\" class=\"headerlink\" title=\"导出(exp)\"></a>导出(exp)</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">exp user&#x2F;pwd@localhost:1521&#x2F;orcl owner&#x3D;user rows&#x3D;y indexes&#x3D;n compress&#x3D;n buffer&#x3D;500000000 file&#x3D;xx.dmp log&#x3D;xx.log<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"导入\"><a href=\"#导入\" class=\"headerlink\" title=\"导入\"></a>导入</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">imp user&#x2F;pwd@localhost&#x2F;orcl file&#x3D;xx.dmp full&#x3D;y ignore&#x3D;y<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.cnblogs.com/arxive/p/10147641.html\">1、连接ORACLE数据库，是不是必须要安装oracle客户端的运行时</a><br><a href=\"https://www.cnblogs.com/zhangyingai/p/7082594.html\">2、ORACLE临时表空间总结</a><br><a href=\"https://www.cnblogs.com/sunnor/p/7097998.html\">3、关于Oracle使用管理员账号登录失败的问题</a><br><a href=\"http://blog.itpub.net/29578568/viewspace-2140148/\">4、oracle 监听日志文件达到4G，导致监听报错的解决方法 </a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c7474e60\">5、Cover</a></p>","categories":[{"name":"数据库","path":"api/categories/数据库.json"}],"tags":[{"name":"数据库","path":"api/tags/数据库.json"},{"name":"Oracle","path":"api/tags/Oracle.json"}]}