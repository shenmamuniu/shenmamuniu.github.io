{"title":"升级Nginx的Openssl版本","slug":"98","date":"2021-05-07T11:15:07.000Z","updated":"2021-05-07T11:15:07.000Z","comments":true,"path":"api/articles/98.json","realPath":null,"excerpt":"叮咚，你家的系统又有漏洞了，这次是openssl相关的漏洞：CVE-2016-8610，本次记录漏洞修复过程，主要为升级opnessl至最新版。","covers":null,"cover":null,"content":"<p>叮咚，你家的系统又有漏洞了，这次是openssl相关的漏洞：CVE-2016-8610，本次记录漏洞修复过程，主要为升级opnessl至最新版。</p>\n<span id=\"more\"></span>\n<h2 id=\"应用配置\"><a href=\"#应用配置\" class=\"headerlink\" title=\"应用配置\"></a>应用配置</h2><p>Nginx:1.18.0<br>Openssl:1.1.1k<br>OS:Asianux SP4</p>\n<h2 id=\"升级Openssl版本\"><a href=\"#升级Openssl版本\" class=\"headerlink\" title=\"升级Openssl版本\"></a>升级Openssl版本</h2><h3 id=\"g-的安装\"><a href=\"#g-的安装\" class=\"headerlink\" title=\"g++的安装\"></a>g++的安装</h3><p>从源码编译Openssl需要g++,因此可以先看系统有没有安装g++:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">g++ -v<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>如果没有安装，需要安装g++,安装g++涉及到的库大概有10+，因此要有一定的耐心,可参考：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">rpm -ivh kernel-headers-2.6.32-431.20.3.el6.x86_64.rpm\nrpm -ivh glibc-headers-2.12-1.132.AXS4.2.x86_64.rpm\nrpm -ivh glibc-devel-2.12-1.132.AXS4.2.x86_64.rpm\nrpm -ivh mpfr-2.4.1-6.AXS4.x86_64.rpm\nrpm -ivh ppl-0.10.2-11.AXS4.x86_64.rpm\nrpm -ivh cloog-ppl-0.15.7-1.2.AXS4.x86_64.rpm\nrpm -ivh cpp-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh libgomp-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh gcc-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh libstdc++-devel-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh libstdc++-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh gcc-c++-4.4.7-4.AXS4.x86_64.rpm<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>查看gcc版本：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">gcc -v<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"openssl的升级\"><a href=\"#openssl的升级\" class=\"headerlink\" title=\"openssl的升级\"></a>openssl的升级</h3><p>下载openssl的<a href=\"https://www.openssl.org/source/\">最新版本</a>，这里下载的是1.1.1k<br>解压及进入目录:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">tar -zxvf openssl-1.1.1k.tar.gz\ncd openssl-1.1.1k<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>配置、编译、安装：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;config --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;openssl --openssldir&#x3D;&#x2F;usr&#x2F;local&#x2F;openssl no-ssl2\nmake\nmake install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>修改环境变量</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">vi &#x2F;etc&#x2F;profile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>末尾添加如下内容:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;bin:$PATH\nexport LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;lib\nexport LC_ALL&#x3D;&quot;en_US.UTF-8&quot;\nexport LDFLAGS&#x3D;&quot;-L&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;lib -Wl,-rpath,&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;lib&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>保存并使环境变量刷新</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">source &#x2F;etc&#x2F;profile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>检查openssl版本</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">openssl version<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"重新安装Nginx\"><a href=\"#重新安装Nginx\" class=\"headerlink\" title=\"重新安装Nginx\"></a>重新安装Nginx</h2><blockquote>\n<p>需要先停止在运行的Nginx</p>\n</blockquote>\n<p>查看已安装Nginx的配置：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nginx -V<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>配置:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure --without-http_rewrite_module --with-http_ssl_module --with-openssl&#x3D;&#x2F;home&#x2F;user&#x2F;soft&#x2F;openssl-1.1.1k<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>其中with-openssl的参数值为openssl的源码地址<br>编译及安装:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">make&amp;make install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>此时再执行以下命令即可看到Nginx使用的Openssl版本</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nginx -V<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.cnblogs.com/music-liang/p/11888672.html\">1、编译和安装openssl</a><br><a href=\"https://www.cnblogs.com/levcon/p/13409531.html\">2、nginx升级并且使用最新版本openssl</a><br><a href=\"https://alisonmarket.lofter.com/post/2b1789_1c808c676\">3、封面图</a></p>\n","more":"<h2 id=\"应用配置\"><a href=\"#应用配置\" class=\"headerlink\" title=\"应用配置\"></a>应用配置</h2><p>Nginx:1.18.0<br>Openssl:1.1.1k<br>OS:Asianux SP4</p>\n<h2 id=\"升级Openssl版本\"><a href=\"#升级Openssl版本\" class=\"headerlink\" title=\"升级Openssl版本\"></a>升级Openssl版本</h2><h3 id=\"g-的安装\"><a href=\"#g-的安装\" class=\"headerlink\" title=\"g++的安装\"></a>g++的安装</h3><p>从源码编译Openssl需要g++,因此可以先看系统有没有安装g++:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">g++ -v<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>如果没有安装，需要安装g++,安装g++涉及到的库大概有10+，因此要有一定的耐心,可参考：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">rpm -ivh kernel-headers-2.6.32-431.20.3.el6.x86_64.rpm\nrpm -ivh glibc-headers-2.12-1.132.AXS4.2.x86_64.rpm\nrpm -ivh glibc-devel-2.12-1.132.AXS4.2.x86_64.rpm\nrpm -ivh mpfr-2.4.1-6.AXS4.x86_64.rpm\nrpm -ivh ppl-0.10.2-11.AXS4.x86_64.rpm\nrpm -ivh cloog-ppl-0.15.7-1.2.AXS4.x86_64.rpm\nrpm -ivh cpp-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh libgomp-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh gcc-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh libstdc++-devel-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh libstdc++-4.4.7-4.AXS4.x86_64.rpm\nrpm -ivh gcc-c++-4.4.7-4.AXS4.x86_64.rpm<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>查看gcc版本：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">gcc -v<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"openssl的升级\"><a href=\"#openssl的升级\" class=\"headerlink\" title=\"openssl的升级\"></a>openssl的升级</h3><p>下载openssl的<a href=\"https://www.openssl.org/source/\">最新版本</a>，这里下载的是1.1.1k<br>解压及进入目录:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">tar -zxvf openssl-1.1.1k.tar.gz\ncd openssl-1.1.1k<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>配置、编译、安装：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;config --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;openssl --openssldir&#x3D;&#x2F;usr&#x2F;local&#x2F;openssl no-ssl2\nmake\nmake install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>修改环境变量</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">vi &#x2F;etc&#x2F;profile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>末尾添加如下内容:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;bin:$PATH\nexport LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;lib\nexport LC_ALL&#x3D;&quot;en_US.UTF-8&quot;\nexport LDFLAGS&#x3D;&quot;-L&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;lib -Wl,-rpath,&#x2F;usr&#x2F;local&#x2F;openssl&#x2F;lib&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>保存并使环境变量刷新</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">source &#x2F;etc&#x2F;profile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>检查openssl版本</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">openssl version<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"重新安装Nginx\"><a href=\"#重新安装Nginx\" class=\"headerlink\" title=\"重新安装Nginx\"></a>重新安装Nginx</h2><blockquote>\n<p>需要先停止在运行的Nginx</p>\n</blockquote>\n<p>查看已安装Nginx的配置：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nginx -V<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>配置:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure --without-http_rewrite_module --with-http_ssl_module --with-openssl&#x3D;&#x2F;home&#x2F;user&#x2F;soft&#x2F;openssl-1.1.1k<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>其中with-openssl的参数值为openssl的源码地址<br>编译及安装:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">make&amp;make install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>此时再执行以下命令即可看到Nginx使用的Openssl版本</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nginx -V<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.cnblogs.com/music-liang/p/11888672.html\">1、编译和安装openssl</a><br><a href=\"https://www.cnblogs.com/levcon/p/13409531.html\">2、nginx升级并且使用最新版本openssl</a><br><a href=\"https://alisonmarket.lofter.com/post/2b1789_1c808c676\">3、封面图</a></p>","categories":[{"name":"应用安全","path":"api/categories/应用安全.json"}],"tags":[{"name":"Nginx","path":"api/tags/Nginx.json"},{"name":"安全","path":"api/tags/安全.json"},{"name":"Openssl","path":"api/tags/Openssl.json"}]}