{"title":"Python查询mariadb数据库总是查到缓存的问题","slug":"123","date":"2022-06-13T13:54:00.000Z","updated":"2022-06-13T13:56:52.000Z","comments":true,"path":"api/articles/123.json","realPath":null,"excerpt":"Python中操作Mariadb有多个包，这里用了mariadb和pymysql两种包，大体一致，可能mariadb这个包的部分类的函数没有pymysql那么丰富。","covers":null,"cover":null,"content":"<p>Python中操作Mariadb有多个包，这里用了mariadb和pymysql两种包，大体一致，可能mariadb这个包的部分类的函数没有pymysql那么丰富。</p>\n<span id=\"more\"></span>\n<h2 id=\"应用环境\"><a href=\"#应用环境\" class=\"headerlink\" title=\"应用环境\"></a>应用环境</h2><p>OS:win10<br>Mariadb(数据库软件):10.6<br>Python:3.9<br>PyMySQL:1.0.2<br>mariadb:1.0.11</p>\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>这里使用了tornado发布了一个服务，用来查询数据库中某个表的记录数，因为是实时数据展示，所以我这里查询还是比较快，但当我数据有更新时，这里返回的还是同一个值:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import mariadb\nconn&#x3D; mariadb.connect(user&#x3D;&quot;xx&quot;, host&#x3D;&quot;localhost&quot;, database&#x3D;&quot;xxx&quot;, password&#x3D;&quot;xxx&quot;)\nclass AisCountHandler(tornado.web.RequestHandler):\n    def post(self):\n        querySql&#x3D;&quot;select count(*) from jtb&quot;\n        cursor&#x3D; conn.cursor(buffered&#x3D;False)\n        cursor.execute(querySql)\n        result&#x3D;cursor.fetchone()[0]\n        self.write(str(result))\n    def options(self):\n        self.set_status(204)\n        self.finish()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"使用reset函数重置连接\"><a href=\"#使用reset函数重置连接\" class=\"headerlink\" title=\"使用reset函数重置连接\"></a>使用reset函数重置连接</h2><p>由于mariadb中的cursor这里没有close函数,因此猜测是连接的问题，因此在self.write前面调用重置连接函数即可：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">conn.reset()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>关于[Connection.reset()](<a href=\"https://mariadb-corporation.github.io/mariadb-connector-python/connection.html?highlight=connection#\">https://mariadb-corporation.github.io/mariadb-connector-python/connection.html?highlight=connection#</a> mariadb.connections.Connection)<br>   Resets the current connection and clears session state and pending results. Open cursors will become invalid and cannot be used anymore.</p>\n</blockquote>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://huadou145.lofter.com/post/205d4db3_1c7247e32\">1、封面来源</a></p>\n","more":"<h2 id=\"应用环境\"><a href=\"#应用环境\" class=\"headerlink\" title=\"应用环境\"></a>应用环境</h2><p>OS:win10<br>Mariadb(数据库软件):10.6<br>Python:3.9<br>PyMySQL:1.0.2<br>mariadb:1.0.11</p>\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>这里使用了tornado发布了一个服务，用来查询数据库中某个表的记录数，因为是实时数据展示，所以我这里查询还是比较快，但当我数据有更新时，这里返回的还是同一个值:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">import mariadb\nconn&#x3D; mariadb.connect(user&#x3D;&quot;xx&quot;, host&#x3D;&quot;localhost&quot;, database&#x3D;&quot;xxx&quot;, password&#x3D;&quot;xxx&quot;)\nclass AisCountHandler(tornado.web.RequestHandler):\n    def post(self):\n        querySql&#x3D;&quot;select count(*) from jtb&quot;\n        cursor&#x3D; conn.cursor(buffered&#x3D;False)\n        cursor.execute(querySql)\n        result&#x3D;cursor.fetchone()[0]\n        self.write(str(result))\n    def options(self):\n        self.set_status(204)\n        self.finish()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"使用reset函数重置连接\"><a href=\"#使用reset函数重置连接\" class=\"headerlink\" title=\"使用reset函数重置连接\"></a>使用reset函数重置连接</h2><p>由于mariadb中的cursor这里没有close函数,因此猜测是连接的问题，因此在self.write前面调用重置连接函数即可：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">conn.reset()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>关于[Connection.reset()](<a href=\"https://mariadb-corporation.github.io/mariadb-connector-python/connection.html?highlight=connection#\">https://mariadb-corporation.github.io/mariadb-connector-python/connection.html?highlight=connection#</a> mariadb.connections.Connection)<br>   Resets the current connection and clears session state and pending results. Open cursors will become invalid and cannot be used anymore.</p>\n</blockquote>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://huadou145.lofter.com/post/205d4db3_1c7247e32\">1、封面来源</a></p>","categories":[{"name":"Python","path":"api/categories/Python.json"}],"tags":[{"name":"Python","path":"api/tags/Python.json"},{"name":"数据库","path":"api/tags/数据库.json"}]}