{"title":"配置web服务器中SSL使用的TLS版本","slug":"配置web服务器中SSL使用的TLS版本","date":"2023-02-04T07:12:36.000Z","updated":"2023-02-04T07:24:14.718Z","comments":true,"path":"api/articles/配置web服务器中SSL使用的TLS版本.json","realPath":null,"excerpt":"本文介绍配置Nginx和Tomcat中TLS的版本为1.2，其中1.0和1.1已于2020年被弃用。","covers":null,"cover":null,"content":"<p>本文介绍配置Nginx和Tomcat中TLS的版本为1.2，其中1.0和1.1已于2020年被弃用。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"应用环境\"><a href=\"#应用环境\" class=\"headerlink\" title=\"应用环境\"></a>应用环境</h2><p>OS: Win10</p>\n<p>Openssl: 3.0.3</p>\n<p>Tomcat: 9.0</p>\n<h2 id=\"安全信息提示\"><a href=\"#安全信息提示\" class=\"headerlink\" title=\"安全信息提示\"></a>安全信息提示</h2><p>SSL&#x2F;TLS:已弃用的TLSv1.0和TLSv1.1协议检测。</p>\n<h2 id=\"检测SSL支持的TLS的版本\"><a href=\"#检测SSL支持的TLS的版本\" class=\"headerlink\" title=\"检测SSL支持的TLS的版本\"></a>检测SSL支持的TLS的版本</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">openssl s_client <span class=\"token parameter variable\">-connect</span> localhost:8443 <span class=\"token parameter variable\">-tls1_2</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>tls版本：-tls1、-tls1_1、-tls1_2、-tls1_3</p>\n</blockquote>\n<h2 id=\"Tomcat配置ssl\"><a href=\"#Tomcat配置ssl\" class=\"headerlink\" title=\"Tomcat配置ssl\"></a>Tomcat配置ssl</h2><p>在server.xml中:</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Connector</span>\n           <span class=\"token attr-name\">port</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8443<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">maxThreads</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">scheme</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">secure</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">SSLEnabled</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n     <span class=\"token attr-name\">keystoreFile</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>xx.p12<span class=\"token punctuation\">\"</span></span> \n     <span class=\"token attr-name\">keystorePass</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>xx<span class=\"token punctuation\">\"</span></span>\n     <span class=\"token attr-name\">keystoreType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PKCS12<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">clientAuth</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">sslEnabledProtocols</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TLSv1.2,TLSv1.1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">sslProtocol</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TLS<span class=\"token punctuation\">\"</span></span>\n     <span class=\"token punctuation\">/></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>配置参数: sslEnabledProtocols</p>\n<p>此时如果执行以下命令：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">openssl s_client <span class=\"token parameter variable\">-connect</span> localhost:8443 <span class=\"token parameter variable\">-tls1_2</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>会得到含有session-id的信息，表示成功建立的会话：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">SSL-Session:\n    Protocol  : TLSv1.1\n    Cipher    : 0000\n    Session-ID: 63DC6861ED2A37C74AB5921C634687939C09DE0198959EE9369292681D3DA9EA<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>如果执行以下命令:</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">openssl s_client <span class=\"token parameter variable\">-connect</span> localhost:8443 <span class=\"token parameter variable\">-tls1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>则此处的session-id为空，表示会话建立失败，未启用tls1.0版本</p>\n<h2 id=\"Nginx的SSL配置中设置支持的tls版本\"><a href=\"#Nginx的SSL配置中设置支持的tls版本\" class=\"headerlink\" title=\"Nginx的SSL配置中设置支持的tls版本\"></a>Nginx的SSL配置中设置支持的tls版本</h2><pre class=\"line-numbers language-nginx\" data-language=\"nginx\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">listen</span> <span class=\"token number\">8443</span> ssl</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_certificate</span>   ../cert/localhost.pem</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_certificate_key</span>  ../cert/localhost-key.pem</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_session_timeout</span> <span class=\"token number\">5m</span></span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_protocols</span> TLSv1.2</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_prefer_server_ciphers</span> <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>参数为ssl_protocals</p>\n</blockquote>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><p><a href=\"https://www.cnblogs.com/harbin1900/p/16805959.html\">1、Tomcat 启用TLS1.2 1.3 禁用TLS1.0 1.1</a></p>\n<p><a href=\"https://www.cnblogs.com/zklymm/p/16356119.html\">2、SpringBoot配置SSL</a></p>\n","more":"<h2 id=\"应用环境\"><a href=\"#应用环境\" class=\"headerlink\" title=\"应用环境\"></a>应用环境</h2><p>OS: Win10</p>\n<p>Openssl: 3.0.3</p>\n<p>Tomcat: 9.0</p>\n<h2 id=\"安全信息提示\"><a href=\"#安全信息提示\" class=\"headerlink\" title=\"安全信息提示\"></a>安全信息提示</h2><p>SSL&#x2F;TLS:已弃用的TLSv1.0和TLSv1.1协议检测。</p>\n<h2 id=\"检测SSL支持的TLS的版本\"><a href=\"#检测SSL支持的TLS的版本\" class=\"headerlink\" title=\"检测SSL支持的TLS的版本\"></a>检测SSL支持的TLS的版本</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">openssl s_client <span class=\"token parameter variable\">-connect</span> localhost:8443 <span class=\"token parameter variable\">-tls1_2</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>tls版本：-tls1、-tls1_1、-tls1_2、-tls1_3</p>\n</blockquote>\n<h2 id=\"Tomcat配置ssl\"><a href=\"#Tomcat配置ssl\" class=\"headerlink\" title=\"Tomcat配置ssl\"></a>Tomcat配置ssl</h2><p>在server.xml中:</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Connector</span>\n           <span class=\"token attr-name\">port</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8443<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">maxThreads</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">scheme</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">secure</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">SSLEnabled</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n     <span class=\"token attr-name\">keystoreFile</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>xx.p12<span class=\"token punctuation\">\"</span></span> \n     <span class=\"token attr-name\">keystorePass</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>xx<span class=\"token punctuation\">\"</span></span>\n     <span class=\"token attr-name\">keystoreType</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>PKCS12<span class=\"token punctuation\">\"</span></span>\n           <span class=\"token attr-name\">clientAuth</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">sslEnabledProtocols</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TLSv1.2,TLSv1.1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">sslProtocol</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>TLS<span class=\"token punctuation\">\"</span></span>\n     <span class=\"token punctuation\">/></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>配置参数: sslEnabledProtocols</p>\n<p>此时如果执行以下命令：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">openssl s_client <span class=\"token parameter variable\">-connect</span> localhost:8443 <span class=\"token parameter variable\">-tls1_2</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>会得到含有session-id的信息，表示成功建立的会话：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">SSL-Session:\n    Protocol  : TLSv1.1\n    Cipher    : 0000\n    Session-ID: 63DC6861ED2A37C74AB5921C634687939C09DE0198959EE9369292681D3DA9EA<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>如果执行以下命令:</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">openssl s_client <span class=\"token parameter variable\">-connect</span> localhost:8443 <span class=\"token parameter variable\">-tls1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>则此处的session-id为空，表示会话建立失败，未启用tls1.0版本</p>\n<h2 id=\"Nginx的SSL配置中设置支持的tls版本\"><a href=\"#Nginx的SSL配置中设置支持的tls版本\" class=\"headerlink\" title=\"Nginx的SSL配置中设置支持的tls版本\"></a>Nginx的SSL配置中设置支持的tls版本</h2><pre class=\"line-numbers language-nginx\" data-language=\"nginx\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">listen</span> <span class=\"token number\">8443</span> ssl</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_certificate</span>   ../cert/localhost.pem</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_certificate_key</span>  ../cert/localhost-key.pem</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_session_timeout</span> <span class=\"token number\">5m</span></span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_protocols</span> TLSv1.2</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token directive\"><span class=\"token keyword\">ssl_prefer_server_ciphers</span> <span class=\"token boolean\">on</span></span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>参数为ssl_protocals</p>\n</blockquote>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><p><a href=\"https://www.cnblogs.com/harbin1900/p/16805959.html\">1、Tomcat 启用TLS1.2 1.3 禁用TLS1.0 1.1</a></p>\n<p><a href=\"https://www.cnblogs.com/zklymm/p/16356119.html\">2、SpringBoot配置SSL</a></p>","categories":[{"name":"应用安全","path":"api/categories/应用安全.json"}],"tags":[{"name":"应用安全","path":"api/tags/应用安全.json"}]}