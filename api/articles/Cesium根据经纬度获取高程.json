{"title":"Cesium根据经纬度获取高程","slug":"Cesium根据经纬度获取高程","date":"2023-02-04T07:26:18.000Z","updated":"2023-02-04T07:50:57.911Z","comments":true,"path":"api/articles/Cesium根据经纬度获取高程.json","excerpt":"本文介绍使用Cesium获取指定地点的高程信息。","covers":null,"content":"<p>本文介绍使用Cesium获取指定地点的高程信息。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"应用环境\"><a href=\"#应用环境\" class=\"headerlink\" title=\"应用环境\"></a>应用环境</h2><p>Cesium: 1.9</p>\n<p>OS：Win10</p>\n<h2 id=\"Cesium加载地形\"><a href=\"#Cesium加载地形\" class=\"headerlink\" title=\"Cesium加载地形\"></a>Cesium加载地形</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> terrainProvider <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cesium<span class=\"token punctuation\">.</span>CesiumTerrainProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost/geodata/terrain\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nviewer<span class=\"token punctuation\">.</span>terrainProvider <span class=\"token operator\">=</span> terrainProvider<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"获取高程信息\"><a href=\"#获取高程信息\" class=\"headerlink\" title=\"获取高程信息\"></a>获取高程信息</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Query the terrain height of two Cartographic positions</span>\n<span class=\"token keyword\">var</span> terrainProvider <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span><span class=\"token function\">createWorldTerrain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> positions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    Cesium<span class=\"token punctuation\">.</span>Cartographic<span class=\"token punctuation\">.</span><span class=\"token function\">fromDegrees</span><span class=\"token punctuation\">(</span><span class=\"token number\">86.925145</span><span class=\"token punctuation\">,</span> <span class=\"token number\">27.988257</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    Cesium<span class=\"token punctuation\">.</span>Cartographic<span class=\"token punctuation\">.</span><span class=\"token function\">fromDegrees</span><span class=\"token punctuation\">(</span><span class=\"token number\">87.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> promise <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span><span class=\"token function\">sampleTerrain</span><span class=\"token punctuation\">(</span>terrainProvider<span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> positions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nCesium<span class=\"token punctuation\">.</span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">updatedPositions</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">// positions[0].height and positions[1].height have been updated.</span>\n    <span class=\"token comment\">// updatedPositions is just a reference to positions.</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p><strong>sampleTerrain(terrainProvider, level, positions)</strong></p>\n<p>其中level为The terrain level-of-detail from which to query terrain heights. </p>\n</blockquote>\n<h2 id=\"Cesium注册点击事件\"><a href=\"#Cesium注册点击事件\" class=\"headerlink\" title=\"Cesium注册点击事件\"></a>Cesium注册点击事件</h2><p>Cesium中Scene对象的pickPosition函数需要开启深度检测，即需要设置depthTestAgainstTerrain为true,否则无法正确获取到点击位置的地理坐标：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">viewer<span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span>globe<span class=\"token punctuation\">.</span>depthTestAgainstTerrain<span class=\"token operator\">=</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>完整的点击事件中获取坐标的代码如下：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clickHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cesium<span class=\"token punctuation\">.</span>ScreenSpaceEventHandler</span><span class=\"token punctuation\">(</span>viewer<span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clickHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setInputAction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">movement</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">var</span> position <span class=\"token operator\">=</span> viewer<span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">pickPosition</span><span class=\"token punctuation\">(</span>movement<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> cartographic <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span>Cartographic<span class=\"token punctuation\">.</span><span class=\"token function\">fromCartesian</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> longitude <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">toDegrees</span><span class=\"token punctuation\">(</span>cartographic<span class=\"token punctuation\">.</span>longitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> latitude <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">toDegrees</span><span class=\"token punctuation\">(</span>cartographic<span class=\"token punctuation\">.</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> Cesium<span class=\"token punctuation\">.</span>ScreenSpaceEventType<span class=\"token punctuation\">.</span><span class=\"token constant\">LEFT_CLICK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>移除点击事件：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">this.clickHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n","more":"<h2 id=\"应用环境\"><a href=\"#应用环境\" class=\"headerlink\" title=\"应用环境\"></a>应用环境</h2><p>Cesium: 1.9</p>\n<p>OS：Win10</p>\n<h2 id=\"Cesium加载地形\"><a href=\"#Cesium加载地形\" class=\"headerlink\" title=\"Cesium加载地形\"></a>Cesium加载地形</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> terrainProvider <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cesium<span class=\"token punctuation\">.</span>CesiumTerrainProvider</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost/geodata/terrain\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nviewer<span class=\"token punctuation\">.</span>terrainProvider <span class=\"token operator\">=</span> terrainProvider<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"获取高程信息\"><a href=\"#获取高程信息\" class=\"headerlink\" title=\"获取高程信息\"></a>获取高程信息</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Query the terrain height of two Cartographic positions</span>\n<span class=\"token keyword\">var</span> terrainProvider <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span><span class=\"token function\">createWorldTerrain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> positions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    Cesium<span class=\"token punctuation\">.</span>Cartographic<span class=\"token punctuation\">.</span><span class=\"token function\">fromDegrees</span><span class=\"token punctuation\">(</span><span class=\"token number\">86.925145</span><span class=\"token punctuation\">,</span> <span class=\"token number\">27.988257</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    Cesium<span class=\"token punctuation\">.</span>Cartographic<span class=\"token punctuation\">.</span><span class=\"token function\">fromDegrees</span><span class=\"token punctuation\">(</span><span class=\"token number\">87.0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> promise <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span><span class=\"token function\">sampleTerrain</span><span class=\"token punctuation\">(</span>terrainProvider<span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> positions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nCesium<span class=\"token punctuation\">.</span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">updatedPositions</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">// positions[0].height and positions[1].height have been updated.</span>\n    <span class=\"token comment\">// updatedPositions is just a reference to positions.</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p><strong>sampleTerrain(terrainProvider, level, positions)</strong></p>\n<p>其中level为The terrain level-of-detail from which to query terrain heights. </p>\n</blockquote>\n<h2 id=\"Cesium注册点击事件\"><a href=\"#Cesium注册点击事件\" class=\"headerlink\" title=\"Cesium注册点击事件\"></a>Cesium注册点击事件</h2><p>Cesium中Scene对象的pickPosition函数需要开启深度检测，即需要设置depthTestAgainstTerrain为true,否则无法正确获取到点击位置的地理坐标：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">viewer<span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span>globe<span class=\"token punctuation\">.</span>depthTestAgainstTerrain<span class=\"token operator\">=</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>完整的点击事件中获取坐标的代码如下：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clickHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cesium<span class=\"token punctuation\">.</span>ScreenSpaceEventHandler</span><span class=\"token punctuation\">(</span>viewer<span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>clickHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setInputAction</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">movement</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">var</span> position <span class=\"token operator\">=</span> viewer<span class=\"token punctuation\">.</span>scene<span class=\"token punctuation\">.</span><span class=\"token function\">pickPosition</span><span class=\"token punctuation\">(</span>movement<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> cartographic <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span>Cartographic<span class=\"token punctuation\">.</span><span class=\"token function\">fromCartesian</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> longitude <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">toDegrees</span><span class=\"token punctuation\">(</span>cartographic<span class=\"token punctuation\">.</span>longitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> latitude <span class=\"token operator\">=</span> Cesium<span class=\"token punctuation\">.</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">toDegrees</span><span class=\"token punctuation\">(</span>cartographic<span class=\"token punctuation\">.</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> Cesium<span class=\"token punctuation\">.</span>ScreenSpaceEventType<span class=\"token punctuation\">.</span><span class=\"token constant\">LEFT_CLICK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>移除点击事件：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">this.clickHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","categories":[{"name":"Cesium","path":"api/categories/Cesium.json"}],"tags":[{"name":"Cesium","path":"api/tags/Cesium.json"}]}