{"title":"CentOS安装Mysql审计插件","slug":"86","date":"2021-03-19T07:39:02.000Z","updated":"2021-03-19T07:39:02.000Z","comments":true,"path":"api/articles/86.json","excerpt":"由于安全测评，要为Mysql数据库安装审计插件，由于最开始选择的时mcafee的审计插件，导致走了很多弯路，这里对审计插件的安装过程做个记录。","covers":null,"content":"<p>由于安全测评，要为Mysql数据库安装审计插件，由于最开始选择的时mcafee的审计插件，导致走了很多弯路，这里对审计插件的安装过程做个记录。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"软件版本\"><a href=\"#软件版本\" class=\"headerlink\" title=\"软件版本\"></a>软件版本</h2><p>Mysql: 5.7.32社区版<br>Centos:7<br>MariaDB: 10.5</p>\n<h2 id=\"审计插件\"><a href=\"#审计插件\" class=\"headerlink\" title=\"审计插件\"></a>审计插件</h2><p>为Mysql社区版本提供审计的插件主要有三个 McAfee MySQL Audit Plugin、Percona Audit Log Plugin、MariaDB Audit Plugin。关于mcafee的插件安装可以参考文后链接，安装复杂且最终安装失败，因此最后选择了mariadb的审计插件，除了最后修改mysql配置时关于审计的配置没有卸载[mysqld]下导致audit插件不起作用，整个过程还是比较顺利的。</p>\n<h2 id=\"安装server-audit-so\"><a href=\"#安装server-audit-so\" class=\"headerlink\" title=\"安装server_audit.so\"></a>安装server_audit.so</h2><h3 id=\"审计插件配置\"><a href=\"#审计插件配置\" class=\"headerlink\" title=\"审计插件配置\"></a>审计插件配置</h3><p>下载MariaDB的安装包，在lib&#x2F;plugin中拿到server_audit.so文件，将其放到mysql的plugin目录下。</p>\n<p>修改Mysql的配置文件：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"># 在[mysqld]标签下添加：\nserver_audit_logging&#x3D;ON\nserver_audit_file_path&#x3D;&#x2F;var&#x2F;log&#x2F;mariadb&#x2F;server_audit111.log\nserver_audit&#x3D;FORCE_PLUS_PERMANENT  # 防止审计插件被卸载\nserver_audit_file_rotate_size&#x3D;1G\nserver_audit_file_rotations&#x3D;10<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>**注意:**一定要写在mysqld下面哦</p>\n<h3 id=\"安装插件\"><a href=\"#安装插件\" class=\"headerlink\" title=\"安装插件\"></a>安装插件</h3><p>重启mysql数据库并登录安装插件</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt;install plugin server_audit soname &#39;server_audit.so&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"查看审计是否开启\"><a href=\"#查看审计是否开启\" class=\"headerlink\" title=\"查看审计是否开启\"></a>查看审计是否开启</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt; show variables like &#39;%audit%&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>如果server_audit_logging的属性值为ON则表明开启。</p>\n<p>接下来，应该就能看到server_audit.log文件中内容了。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>还是maria好啊！！！</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"http://blog.itpub.net/31441024/viewspace-2213103\">1、MySQL5.7审计功能windows系统</a><br><a href=\"https://www.isolves.com/it/sjk/MYSQL/2020-05-13/17830.html\">2、MySQL 安装 MariaDB Audit Plugin 插件，实现审计日志输出</a><br><a href=\"https://lyla7784.lofter.com/post/30a15a3d_1c8923399\">3、封面图源</a></p>\n","more":"<h2 id=\"软件版本\"><a href=\"#软件版本\" class=\"headerlink\" title=\"软件版本\"></a>软件版本</h2><p>Mysql: 5.7.32社区版<br>Centos:7<br>MariaDB: 10.5</p>\n<h2 id=\"审计插件\"><a href=\"#审计插件\" class=\"headerlink\" title=\"审计插件\"></a>审计插件</h2><p>为Mysql社区版本提供审计的插件主要有三个 McAfee MySQL Audit Plugin、Percona Audit Log Plugin、MariaDB Audit Plugin。关于mcafee的插件安装可以参考文后链接，安装复杂且最终安装失败，因此最后选择了mariadb的审计插件，除了最后修改mysql配置时关于审计的配置没有卸载[mysqld]下导致audit插件不起作用，整个过程还是比较顺利的。</p>\n<h2 id=\"安装server-audit-so\"><a href=\"#安装server-audit-so\" class=\"headerlink\" title=\"安装server_audit.so\"></a>安装server_audit.so</h2><h3 id=\"审计插件配置\"><a href=\"#审计插件配置\" class=\"headerlink\" title=\"审计插件配置\"></a>审计插件配置</h3><p>下载MariaDB的安装包，在lib&#x2F;plugin中拿到server_audit.so文件，将其放到mysql的plugin目录下。</p>\n<p>修改Mysql的配置文件：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"># 在[mysqld]标签下添加：\nserver_audit_logging&#x3D;ON\nserver_audit_file_path&#x3D;&#x2F;var&#x2F;log&#x2F;mariadb&#x2F;server_audit111.log\nserver_audit&#x3D;FORCE_PLUS_PERMANENT  # 防止审计插件被卸载\nserver_audit_file_rotate_size&#x3D;1G\nserver_audit_file_rotations&#x3D;10<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>**注意:**一定要写在mysqld下面哦</p>\n<h3 id=\"安装插件\"><a href=\"#安装插件\" class=\"headerlink\" title=\"安装插件\"></a>安装插件</h3><p>重启mysql数据库并登录安装插件</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt;install plugin server_audit soname &#39;server_audit.so&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"查看审计是否开启\"><a href=\"#查看审计是否开启\" class=\"headerlink\" title=\"查看审计是否开启\"></a>查看审计是否开启</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt; show variables like &#39;%audit%&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>如果server_audit_logging的属性值为ON则表明开启。</p>\n<p>接下来，应该就能看到server_audit.log文件中内容了。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>还是maria好啊！！！</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"http://blog.itpub.net/31441024/viewspace-2213103\">1、MySQL5.7审计功能windows系统</a><br><a href=\"https://www.isolves.com/it/sjk/MYSQL/2020-05-13/17830.html\">2、MySQL 安装 MariaDB Audit Plugin 插件，实现审计日志输出</a><br><a href=\"https://lyla7784.lofter.com/post/30a15a3d_1c8923399\">3、封面图源</a></p>","categories":[{"name":"数据库","path":"api/categories/数据库.json"}],"tags":[{"name":"Mysql","path":"api/tags/Mysql.json"},{"name":"安全","path":"api/tags/安全.json"}]}