{"title":"使用POSTGIS的ST_Value函数查询栅格值","slug":"132","date":"2022-08-22T03:42:13.000Z","updated":"2022-08-22T03:42:13.000Z","comments":true,"path":"api/articles/132.json","excerpt":"之前查询dem值时，一直是在ArcServer发布DEM数据，然后通过调用服务的Identify方法来查询的,但由于ArcServer过于庞大,因此考虑用其它方法来替代，这里使用PostGIS的ST_Value函数来进行栅格的查询。","covers":null,"content":"<p>之前查询dem值时，一直是在ArcServer发布DEM数据，然后通过调用服务的Identify方法来查询的,但由于ArcServer过于庞大,因此考虑用其它方法来替代，这里使用PostGIS的ST_Value函数来进行栅格的查询。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"dem数据导入到postgis\"><a href=\"#dem数据导入到postgis\" class=\"headerlink\" title=\"dem数据导入到postgis\"></a>dem数据导入到postgis</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">raster2pgsql.exe -s 4326 -C E:&#x2F;Data&#x2F;dem&#x2F;江津区_DEM.tif public.zjk | psql.exe -h localhost -p 5432 -U postgres -d dem_test -W<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"ST-Value的使用\"><a href=\"#ST-Value的使用\" class=\"headerlink\" title=\"ST_Value的使用\"></a>ST_Value的使用</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT ST_Value(cqdem.rast,1, ST_SetSRID(ST_MakePoint(107.7,30.09),4326),false, &#39;bilinear&#39;)\nFROM public.cqdem<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>The allowed values of the resample parameter are “nearest” which performs the default nearest-neighbor resampling, and “bilinear” which performs a bilinear interpolation to estimate the value between pixel centers.</p>\n</blockquote>\n<p>如果需要坐标转换,geomeotry参数改为以下:<br>ST_Transform(ST_SetSRID(ST_MakePoint(lon,lat),4326),3035)</p>\n<h2 id=\"遗留的问题\"><a href=\"#遗留的问题\" class=\"headerlink\" title=\"遗留的问题\"></a>遗留的问题</h2><p>1、当DEM数据计比较大时，可能会无法导入;<br>2、有的DEM数据即便使用了blinear插值，还是只能查询到整数的结果；</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://qastack.cn/gis/14960/postgis-raster-value-of-a-lat-lon-point\">1、纬度&#x2F;经度点的PostGIS栅格值</a><br><a href=\"http://postgis.net/docs/RT_ST_Value.html\">2、ST_Value</a><br><a href=\"https://lyla7784.lofter.com/post/30a15a3d_1c8923399\">3、封面图源</a></p>\n","more":"<h2 id=\"dem数据导入到postgis\"><a href=\"#dem数据导入到postgis\" class=\"headerlink\" title=\"dem数据导入到postgis\"></a>dem数据导入到postgis</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">raster2pgsql.exe -s 4326 -C E:&#x2F;Data&#x2F;dem&#x2F;江津区_DEM.tif public.zjk | psql.exe -h localhost -p 5432 -U postgres -d dem_test -W<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"ST-Value的使用\"><a href=\"#ST-Value的使用\" class=\"headerlink\" title=\"ST_Value的使用\"></a>ST_Value的使用</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT ST_Value(cqdem.rast,1, ST_SetSRID(ST_MakePoint(107.7,30.09),4326),false, &#39;bilinear&#39;)\nFROM public.cqdem<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>The allowed values of the resample parameter are “nearest” which performs the default nearest-neighbor resampling, and “bilinear” which performs a bilinear interpolation to estimate the value between pixel centers.</p>\n</blockquote>\n<p>如果需要坐标转换,geomeotry参数改为以下:<br>ST_Transform(ST_SetSRID(ST_MakePoint(lon,lat),4326),3035)</p>\n<h2 id=\"遗留的问题\"><a href=\"#遗留的问题\" class=\"headerlink\" title=\"遗留的问题\"></a>遗留的问题</h2><p>1、当DEM数据计比较大时，可能会无法导入;<br>2、有的DEM数据即便使用了blinear插值，还是只能查询到整数的结果；</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://qastack.cn/gis/14960/postgis-raster-value-of-a-lat-lon-point\">1、纬度&#x2F;经度点的PostGIS栅格值</a><br><a href=\"http://postgis.net/docs/RT_ST_Value.html\">2、ST_Value</a><br><a href=\"https://lyla7784.lofter.com/post/30a15a3d_1c8923399\">3、封面图源</a></p>","categories":[{"name":"Python","path":"api/categories/Python.json"}],"tags":[{"name":"空间数据库","path":"api/tags/空间数据库.json"},{"name":"PostGIS","path":"api/tags/PostGIS.json"}]}