{"title":"Typecho安装及部署问题相关","slug":"11","date":"2019-11-16T03:26:00.000Z","updated":"2019-11-19T13:31:21.000Z","comments":true,"path":"api/articles/11.json","excerpt":"本文主要记录Typecho的安装过程，以及安装完成之后对页面链接、头像的处理等。","covers":null,"content":"<p>本文主要记录Typecho的安装过程，以及安装完成之后对页面链接、头像的处理等。</p>\n<span id=\"more\"></span>\n<h2 id=\"1-安装及部署typecho\"><a href=\"#1-安装及部署typecho\" class=\"headerlink\" title=\"1. 安装及部署typecho\"></a>1. 安装及部署typecho</h2><p>操作系统：ubuntu<br>软件：mysql+nginx+php-fpm</p>\n<h3 id=\"安装php\"><a href=\"#安装php\" class=\"headerlink\" title=\"安装php\"></a>安装php</h3><p>apt-get install php</p>\n<h3 id=\"安装数据库\"><a href=\"#安装数据库\" class=\"headerlink\" title=\"安装数据库\"></a>安装数据库</h3><p>mysql的在ubuntu的安装稍微复杂，不在此文描述，如果要求不高，使用sqlite即可</p>\n<h3 id=\"安装php相关扩展\"><a href=\"#安装php相关扩展\" class=\"headerlink\" title=\"安装php相关扩展\"></a>安装php相关扩展</h3><p>这里可以不使用apache2，可以卸载：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">apt-get autoremove apache2 <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>安装php相关扩展</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">apt-get install php-curl\napt-get install php-mbstring\napt-get install php-fpm<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"配置php-fpm\"><a href=\"#配置php-fpm\" class=\"headerlink\" title=\"配置php-fpm\"></a>配置php-fpm</h3><p>找到配置文件：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">vi &#x2F;etc&#x2F;php&#x2F;7.2&#x2F;fpm&#x2F;pool.d&#x2F;www.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>配置一下监听的端口和ip白名单</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">listen &#x3D; 127.0.0.1:9000\nlisten.allowed_clients &#x3D; 127.0.0.1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>重启php-fpm</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">service php7.2-fpm restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"下载typecho并解压\"><a href=\"#下载typecho并解压\" class=\"headerlink\" title=\"下载typecho并解压\"></a>下载typecho并解压</h3><h3 id=\"Nginx配置\"><a href=\"#Nginx配置\" class=\"headerlink\" title=\"Nginx配置\"></a>Nginx配置</h3><p>Nginx需要手动安装，&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;default配置如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">root &#x2F;~ # 配置为typecho所在路径\nlocation ~ \\.php(\\&#x2F;.*)*$ &#123;\n        include snippets&#x2F;fastcgi-php.conf;\n        fastcgi_split_path_info ^((?U).+.php)(&#x2F;?.+)$;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_param PATH_INFO $fastcgi_path_info;\n        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;\n        fastcgi_intercept_errors on;\n        fastcgi_pass 127.0.0.1:9000;\n        &#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这里配置了伪静态，用于解决typecho链接中包含.php的问题，然后就可以启动nginx了，重启之后打开typecho安装页面即可进行安装。</p>\n<h2 id=\"2、typecho配置伪静态\"><a href=\"#2、typecho配置伪静态\" class=\"headerlink\" title=\"2、typecho配置伪静态\"></a>2、typecho配置伪静态</h2><p>作用：去掉博客链接中的.php。<br>修改nginx的配置,加入</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"># 用于伪静态\nif (-f $request_filename&#x2F;index.html) &#123;\n    rewrite (.*) $1&#x2F;index.html break;\n&#125;\nif (-f $request_filename&#x2F;index.php) &#123;\n    rewrite (.*) $1&#x2F;index.php;\n&#125;\nif (!-f $request_filename) &#123;\n    rewrite (.*) &#x2F;index.php;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>然后在typecho的后台——&gt;设置——&gt;永久链接，启用地址重写功能即可，可能会报错，强制重启即可。</p>\n<h2 id=\"3-替换Gravatar为国内源\"><a href=\"#3-替换Gravatar为国内源\" class=\"headerlink\" title=\"3. 替换Gravatar为国内源\"></a>3. 替换Gravatar为国内源</h2><p>在var&#x2F;Typecho&#x2F;Common.php中，修改</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$url &#x3D; $isSecure ? &#39;https:&#x2F;&#x2F;secure.gravatar.com&#39; : &#39;http:&#x2F;&#x2F;www.gravatar.com&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>替换为</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$url &#x3D; $isSecure ? &#39;https:&#x2F;&#x2F;secure.gravatar.com&#39; : &#39;https:&#x2F;&#x2F;cn.gravatar.com&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><strong>注：使用Gravatar头像需要注册wordpress账号</strong></p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.aisheji.org/post/15.html\">1. Typecho修改gravatar头像源为国内服务器源</a></p>\n","more":"<h2 id=\"1-安装及部署typecho\"><a href=\"#1-安装及部署typecho\" class=\"headerlink\" title=\"1. 安装及部署typecho\"></a>1. 安装及部署typecho</h2><p>操作系统：ubuntu<br>软件：mysql+nginx+php-fpm</p>\n<h3 id=\"安装php\"><a href=\"#安装php\" class=\"headerlink\" title=\"安装php\"></a>安装php</h3><p>apt-get install php</p>\n<h3 id=\"安装数据库\"><a href=\"#安装数据库\" class=\"headerlink\" title=\"安装数据库\"></a>安装数据库</h3><p>mysql的在ubuntu的安装稍微复杂，不在此文描述，如果要求不高，使用sqlite即可</p>\n<h3 id=\"安装php相关扩展\"><a href=\"#安装php相关扩展\" class=\"headerlink\" title=\"安装php相关扩展\"></a>安装php相关扩展</h3><p>这里可以不使用apache2，可以卸载：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">apt-get autoremove apache2 <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>安装php相关扩展</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">apt-get install php-curl\napt-get install php-mbstring\napt-get install php-fpm<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"配置php-fpm\"><a href=\"#配置php-fpm\" class=\"headerlink\" title=\"配置php-fpm\"></a>配置php-fpm</h3><p>找到配置文件：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">vi &#x2F;etc&#x2F;php&#x2F;7.2&#x2F;fpm&#x2F;pool.d&#x2F;www.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>配置一下监听的端口和ip白名单</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">listen &#x3D; 127.0.0.1:9000\nlisten.allowed_clients &#x3D; 127.0.0.1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>重启php-fpm</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">service php7.2-fpm restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"下载typecho并解压\"><a href=\"#下载typecho并解压\" class=\"headerlink\" title=\"下载typecho并解压\"></a>下载typecho并解压</h3><h3 id=\"Nginx配置\"><a href=\"#Nginx配置\" class=\"headerlink\" title=\"Nginx配置\"></a>Nginx配置</h3><p>Nginx需要手动安装，&#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;default配置如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">root &#x2F;~ # 配置为typecho所在路径\nlocation ~ \\.php(\\&#x2F;.*)*$ &#123;\n        include snippets&#x2F;fastcgi-php.conf;\n        fastcgi_split_path_info ^((?U).+.php)(&#x2F;?.+)$;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_param PATH_INFO $fastcgi_path_info;\n        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;\n        fastcgi_intercept_errors on;\n        fastcgi_pass 127.0.0.1:9000;\n        &#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这里配置了伪静态，用于解决typecho链接中包含.php的问题，然后就可以启动nginx了，重启之后打开typecho安装页面即可进行安装。</p>\n<h2 id=\"2、typecho配置伪静态\"><a href=\"#2、typecho配置伪静态\" class=\"headerlink\" title=\"2、typecho配置伪静态\"></a>2、typecho配置伪静态</h2><p>作用：去掉博客链接中的.php。<br>修改nginx的配置,加入</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"># 用于伪静态\nif (-f $request_filename&#x2F;index.html) &#123;\n    rewrite (.*) $1&#x2F;index.html break;\n&#125;\nif (-f $request_filename&#x2F;index.php) &#123;\n    rewrite (.*) $1&#x2F;index.php;\n&#125;\nif (!-f $request_filename) &#123;\n    rewrite (.*) &#x2F;index.php;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>然后在typecho的后台——&gt;设置——&gt;永久链接，启用地址重写功能即可，可能会报错，强制重启即可。</p>\n<h2 id=\"3-替换Gravatar为国内源\"><a href=\"#3-替换Gravatar为国内源\" class=\"headerlink\" title=\"3. 替换Gravatar为国内源\"></a>3. 替换Gravatar为国内源</h2><p>在var&#x2F;Typecho&#x2F;Common.php中，修改</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$url &#x3D; $isSecure ? &#39;https:&#x2F;&#x2F;secure.gravatar.com&#39; : &#39;http:&#x2F;&#x2F;www.gravatar.com&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>替换为</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$url &#x3D; $isSecure ? &#39;https:&#x2F;&#x2F;secure.gravatar.com&#39; : &#39;https:&#x2F;&#x2F;cn.gravatar.com&#39;;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><strong>注：使用Gravatar头像需要注册wordpress账号</strong></p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.aisheji.org/post/15.html\">1. Typecho修改gravatar头像源为国内服务器源</a></p>","categories":[],"tags":[{"name":"typecho","path":"api/tags/typecho.json"}]}