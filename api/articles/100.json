{"title":"Nexus管理员密码重置","slug":"100","date":"2021-05-21T08:22:33.000Z","updated":"2021-05-21T08:22:33.000Z","comments":true,"path":"api/articles/100.json","excerpt":"Nexus是一个强大的包管理管理，可以用它来搭建自己的maven、npm、nuget等私服。本文主要记录对Nexus管理员密码进行重置的过程。","covers":null,"content":"<p>Nexus是一个强大的包管理管理，可以用它来搭建自己的maven、npm、nuget等私服。本文主要记录对Nexus管理员密码进行重置的过程。</p>\n<span id=\"more\"></span>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><p>OS:Ubuntu 16.04<br>Nexus:3.25.0-03</p>\n<h2 id=\"密码重置\"><a href=\"#密码重置\" class=\"headerlink\" title=\"密码重置\"></a>密码重置</h2><p>找到 sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security&#x2F;user.pcl文件</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">find &#x2F; -name user.pcl<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>找到文件的如下地方：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">admin^ZAdministrator^HUser^Lactive&amp;tianya@zifangdt.com&lt;8c&gt;^B$shiro1$SHA-512$1024$\n\nNE+wqQq&#x2F;TmjZMvfI7ENh&#x2F;g&#x3D;&#x3D;$V4yPw8T64UQ6GfJfxYq2hLsVrBY8D1v+bktfOxGdt4b&#x2F;9BthpWPNUy&#x2F;CBk6V9iA0nHpzYzJFWO8v&#x2F;tZFtES8CA&#x3D;&#x3D;\n\n^Aÿÿÿÿÿÿÿÿÿþÿÿ<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>把$和^之间的内容替换^Aÿÿÿÿÿÿÿÿÿþ成上面第二行的内容，修改后的密码为amdin123,用户名admin</p>\n<blockquote>\n<p>Tips:需要重启nexus</p>\n</blockquote>\n<h2 id=\"密码重置之后引起的数据库只读\"><a href=\"#密码重置之后引起的数据库只读\" class=\"headerlink\" title=\"密码重置之后引起的数据库只读\"></a>密码重置之后引起的数据库只读</h2><p>重置完密码之后，再次修改密码发现出现了以下问题：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">[&#39;user.pcl&#39; :1;], storage is switched to &#39;read only&#39; mode<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>user所在的security数据库变成了只读,此时需要把此数据库删除再新建，具体过程如下：</p>\n<h3 id=\"备份数据库\"><a href=\"#备份数据库\" class=\"headerlink\" title=\"备份数据库\"></a>备份数据库</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;nexus stop\ncp -r &#x2F;opt&#x2F;nexus&#x2F;sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security &#x2F;opt&#x2F;nexus&#x2F;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"数据库删除及恢复\"><a href=\"#数据库删除及恢复\" class=\"headerlink\" title=\"数据库删除及恢复\"></a>数据库删除及恢复</h3><p>到Nexus安装目录下&#x2F;lib&#x2F;support下，运行nexus-orient-console.jar</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">java -jar nexus-orient-console.jar<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>然后连接出错的数据库</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">orientdb&gt; connect PLOCAL:&#x2F;opt&#x2F;nexus&#x2F;sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security admin admin\n\n# 导出\norientdb &#123;db&#x3D;security&#125;&gt; EXPORT DATABASE &#x2F;opt&#x2F;backup\n\n# 关闭连接\norientdb &#123;db&#x3D;security&#125;&gt; DISCONNECT\n\n# 删除出问题的库\norientdb&gt; DROP DATABASE PLOCAL:&#x2F;opt&#x2F;nexus&#x2F;sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security admin admin\n\n# 重新创建出问题的库\norientdb&gt; CREATE DATABASE PLOCAL:&#x2F;opt&#x2F;nexus&#x2F;sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security admin admin\n\n# 导入\norientdb &#123;db&#x3D;security&#125;&gt; IMPORT DATABASE &#x2F;backup&#x2F;backup.json.gz\n\n# 关闭连接\norientdb &#123;db&#x3D;security&#125;&gt; DISCONNECT\n\n# 退出控制台\norientdb&gt; EXIT<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>重启nexus即可：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nohup .&#x2F;nexus run &gt;nexus.out 2&gt;&amp;1 &amp;\nor\n.&#x2F;nexus start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://blog.51cto.com/ywliyq/2451936\">1、nexus3.2重置admin密码</a><br><a href=\"https://blog.lightmao.cn/2020/07/24/67/\">2、Nexus搭建Maven私服</a><br><a href=\"https://blog.csdn.net/mutian6655/article/details/112758278\">3、Nexus因异常重启导致OrientDB数据库变为只读的问题修复</a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c81c6e8f\">4、封面图源</a></p>\n","more":"<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><p>OS:Ubuntu 16.04<br>Nexus:3.25.0-03</p>\n<h2 id=\"密码重置\"><a href=\"#密码重置\" class=\"headerlink\" title=\"密码重置\"></a>密码重置</h2><p>找到 sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security&#x2F;user.pcl文件</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">find &#x2F; -name user.pcl<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>找到文件的如下地方：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">admin^ZAdministrator^HUser^Lactive&amp;tianya@zifangdt.com&lt;8c&gt;^B$shiro1$SHA-512$1024$\n\nNE+wqQq&#x2F;TmjZMvfI7ENh&#x2F;g&#x3D;&#x3D;$V4yPw8T64UQ6GfJfxYq2hLsVrBY8D1v+bktfOxGdt4b&#x2F;9BthpWPNUy&#x2F;CBk6V9iA0nHpzYzJFWO8v&#x2F;tZFtES8CA&#x3D;&#x3D;\n\n^Aÿÿÿÿÿÿÿÿÿþÿÿ<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>把$和^之间的内容替换^Aÿÿÿÿÿÿÿÿÿþ成上面第二行的内容，修改后的密码为amdin123,用户名admin</p>\n<blockquote>\n<p>Tips:需要重启nexus</p>\n</blockquote>\n<h2 id=\"密码重置之后引起的数据库只读\"><a href=\"#密码重置之后引起的数据库只读\" class=\"headerlink\" title=\"密码重置之后引起的数据库只读\"></a>密码重置之后引起的数据库只读</h2><p>重置完密码之后，再次修改密码发现出现了以下问题：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">[&#39;user.pcl&#39; :1;], storage is switched to &#39;read only&#39; mode<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>user所在的security数据库变成了只读,此时需要把此数据库删除再新建，具体过程如下：</p>\n<h3 id=\"备份数据库\"><a href=\"#备份数据库\" class=\"headerlink\" title=\"备份数据库\"></a>备份数据库</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;nexus stop\ncp -r &#x2F;opt&#x2F;nexus&#x2F;sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security &#x2F;opt&#x2F;nexus&#x2F;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h3 id=\"数据库删除及恢复\"><a href=\"#数据库删除及恢复\" class=\"headerlink\" title=\"数据库删除及恢复\"></a>数据库删除及恢复</h3><p>到Nexus安装目录下&#x2F;lib&#x2F;support下，运行nexus-orient-console.jar</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">java -jar nexus-orient-console.jar<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>然后连接出错的数据库</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">orientdb&gt; connect PLOCAL:&#x2F;opt&#x2F;nexus&#x2F;sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security admin admin\n\n# 导出\norientdb &#123;db&#x3D;security&#125;&gt; EXPORT DATABASE &#x2F;opt&#x2F;backup\n\n# 关闭连接\norientdb &#123;db&#x3D;security&#125;&gt; DISCONNECT\n\n# 删除出问题的库\norientdb&gt; DROP DATABASE PLOCAL:&#x2F;opt&#x2F;nexus&#x2F;sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security admin admin\n\n# 重新创建出问题的库\norientdb&gt; CREATE DATABASE PLOCAL:&#x2F;opt&#x2F;nexus&#x2F;sonatype-work&#x2F;nexus3&#x2F;db&#x2F;security admin admin\n\n# 导入\norientdb &#123;db&#x3D;security&#125;&gt; IMPORT DATABASE &#x2F;backup&#x2F;backup.json.gz\n\n# 关闭连接\norientdb &#123;db&#x3D;security&#125;&gt; DISCONNECT\n\n# 退出控制台\norientdb&gt; EXIT<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>重启nexus即可：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nohup .&#x2F;nexus run &gt;nexus.out 2&gt;&amp;1 &amp;\nor\n.&#x2F;nexus start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://blog.51cto.com/ywliyq/2451936\">1、nexus3.2重置admin密码</a><br><a href=\"https://blog.lightmao.cn/2020/07/24/67/\">2、Nexus搭建Maven私服</a><br><a href=\"https://blog.csdn.net/mutian6655/article/details/112758278\">3、Nexus因异常重启导致OrientDB数据库变为只读的问题修复</a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c81c6e8f\">4、封面图源</a></p>","categories":[{"name":"运维","path":"api/categories/运维.json"}],"tags":[{"name":"Nexus","path":"api/tags/Nexus.json"},{"name":"私服","path":"api/tags/私服.json"}]}