{"title":"ArcGIS JS API加载倾斜三维模型","slug":"31","date":"2019-12-14T13:48:00.000Z","updated":"2019-12-14T13:48:33.000Z","comments":true,"path":"api/articles/31.json","realPath":null,"excerpt":"通过ContextCapture将倾斜摄影模型导出为SLPK格式，可供ArcGIS平台使用。","covers":null,"cover":null,"content":"<p>通过ContextCapture将倾斜摄影模型导出为SLPK格式，可供ArcGIS平台使用。</p>\n<span id=\"more\"></span>\n<h2 id=\"软件版本\"><a href=\"#软件版本\" class=\"headerlink\" title=\"软件版本\"></a>软件版本</h2><p>Arcgis api for js: 4.13</p>\n<h2 id=\"SLPK格式\"><a href=\"#SLPK格式\" class=\"headerlink\" title=\"SLPK格式\"></a>SLPK格式</h2><p>全程Arcgis Desktop Scene Layer Package,是一种基于I3S的三维数据格式规范，为OGC新的国际三维标准，是由ESRI公司发起。</p>\n<p>具备生命行和可扩展性，并已经用于不同类型的三维数据：<br>a.离散三维模型（3D Objects）：主要指独立建模物、建筑构造物；<br>b.密集格网（Integrated Meshes）：主要指倾斜摄影测量建模成果；<br>c.点（Points）：主要指城市小品如行道树、城市道路设施等；<br>d.点云（Point Clouds）：主要指Las数据集，暂不支持在10.5中发布成Scene Service；</p>\n<h2 id=\"SLPK数据的获取\"><a href=\"#SLPK数据的获取\" class=\"headerlink\" title=\"SLPK数据的获取\"></a>SLPK数据的获取</h2><p>目前支持SLPK数据导出的软件有Esri的ArcGIS、Bentley的ContextCapture、Skyline的PhotoMesh，这里我们使用ContextCapture，资源压缩类型（store&#x2F;deflate）,其中一种为压缩的，生成的文件后缀为.slpk,另一种无压缩，为散列的文件，前者我们可以使用ArcGIS Pro进行发布供ArcGIS平台使用；后者我们接下来使用ArcGIS Js Api进行直接加载。</p>\n<h2 id=\"ArcGIS-JS-API加载SLPK数据\"><a href=\"#ArcGIS-JS-API加载SLPK数据\" class=\"headerlink\" title=\"ArcGIS JS API加载SLPK数据\"></a>ArcGIS JS API加载SLPK数据</h2><h3 id=\"IntegratedMeshLayer的使用\"><a href=\"#IntegratedMeshLayer的使用\" class=\"headerlink\" title=\"IntegratedMeshLayer的使用\"></a>IntegratedMeshLayer的使用</h3><p>这里使用的SLPK数据类型为倾斜摄影测量的成果，机密集格网，对应的图层类型IntegratedMeshLayer。<br>代码如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">require([&quot;esri&#x2F;Map&quot;, \n     &quot;esri&#x2F;views&#x2F;SceneView&quot;,\n     &quot;esri&#x2F;layers&#x2F;IntegratedMeshLayer&quot;,\n     &quot;esri&#x2F;geometry&#x2F;Extent&quot;\n   ], function(Map, SceneView,IntegratedMeshLayer,Extent) &#123;\n       var layer &#x3D; new IntegratedMeshLayer(&#123;\n         url:&quot;&quot;\n       &#125;);\n       var map &#x3D; new Map(&#123;\n         basemap: &quot;streets&quot;,\n         layers: [layer],\n         ground: &quot;world-elevation&quot;\n       &#125;);\n       var view &#x3D; new SceneView(&#123;\n         container: &quot;viewDiv&quot;, &#x2F;&#x2F; Reference to the scene div created in step 5\n         map: map, &#x2F;&#x2F; Reference to the map object created before the scene\n     &#125;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>官方实例：<a href=\"https://developers.arcgis.com/javascript/latest/sample-code/sandbox/index.html?sample=layers-integratedmeshlayer\">https://developers.arcgis.com/javascript/latest/sample-code/sandbox/index.html?sample=layers-integratedmeshlayer</a><br>其中IntegratedMeshLayer的url即为slpk所在目录，可以使用Nginx做反向代理</p>\n<h3 id=\"Nginx跨域配置\"><a href=\"#Nginx跨域配置\" class=\"headerlink\" title=\"Nginx跨域配置\"></a>Nginx跨域配置</h3><p>location节点内添加如下内容</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">location &#x2F;&#123;\n\t\t\n\t\t\tadd_header Access-Control-Allow-Origin *;\n\t\t\tadd_header Access-Control-Allow-Methods &#39;GET, POST, OPTIONS&#39;;\n\t\t\tadd_header Access-Control-Allow-Headers &#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#39;;\n\t\t&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"slpk数据中-json文件访问不到的问题\"><a href=\"#slpk数据中-json文件访问不到的问题\" class=\"headerlink\" title=\"slpk数据中.json文件访问不到的问题\"></a>slpk数据中.json文件访问不到的问题</h3><p>可在nginx中设置默认文件，添加如下部分：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">index 3dNodeIndexDocument.json 3dSceneLayer.json sharedResource.json 1_0.bin 0.bin 0.json;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"featurs、geometry、textures中的bin文件访问不到\"><a href=\"#featurs、geometry、textures中的bin文件访问不到\" class=\"headerlink\" title=\"featurs、geometry、textures中的bin文件访问不到\"></a>featurs、geometry、textures中的bin文件访问不到</h3><p>这里以features为例，在每个features内根据文件名创建同名目录，然后把文件复制进入即可，如旧目录结构如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">features\n  0.json<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>修改后的目录结构为：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">features\n  0\n    0.json<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>这里可自行写文件批量处理工具。</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.sohu.com/a/192789888_609577\">1、重磅：Esri-I3S标准规范将作为OGC新的国际三维标准 </a><br><a href=\"https://www.cnblogs.com/oukele/p/11003307.html\">2、Java实现复制文件或者文件夹</a><br><a href=\"https://www.cnblogs.com/jianmingyuan/p/10899917.html\">3、Windows下Nginx的启动、停止、重启等命令</a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c72a6dad\">3、封面图</a></p>\n","more":"<h2 id=\"软件版本\"><a href=\"#软件版本\" class=\"headerlink\" title=\"软件版本\"></a>软件版本</h2><p>Arcgis api for js: 4.13</p>\n<h2 id=\"SLPK格式\"><a href=\"#SLPK格式\" class=\"headerlink\" title=\"SLPK格式\"></a>SLPK格式</h2><p>全程Arcgis Desktop Scene Layer Package,是一种基于I3S的三维数据格式规范，为OGC新的国际三维标准，是由ESRI公司发起。</p>\n<p>具备生命行和可扩展性，并已经用于不同类型的三维数据：<br>a.离散三维模型（3D Objects）：主要指独立建模物、建筑构造物；<br>b.密集格网（Integrated Meshes）：主要指倾斜摄影测量建模成果；<br>c.点（Points）：主要指城市小品如行道树、城市道路设施等；<br>d.点云（Point Clouds）：主要指Las数据集，暂不支持在10.5中发布成Scene Service；</p>\n<h2 id=\"SLPK数据的获取\"><a href=\"#SLPK数据的获取\" class=\"headerlink\" title=\"SLPK数据的获取\"></a>SLPK数据的获取</h2><p>目前支持SLPK数据导出的软件有Esri的ArcGIS、Bentley的ContextCapture、Skyline的PhotoMesh，这里我们使用ContextCapture，资源压缩类型（store&#x2F;deflate）,其中一种为压缩的，生成的文件后缀为.slpk,另一种无压缩，为散列的文件，前者我们可以使用ArcGIS Pro进行发布供ArcGIS平台使用；后者我们接下来使用ArcGIS Js Api进行直接加载。</p>\n<h2 id=\"ArcGIS-JS-API加载SLPK数据\"><a href=\"#ArcGIS-JS-API加载SLPK数据\" class=\"headerlink\" title=\"ArcGIS JS API加载SLPK数据\"></a>ArcGIS JS API加载SLPK数据</h2><h3 id=\"IntegratedMeshLayer的使用\"><a href=\"#IntegratedMeshLayer的使用\" class=\"headerlink\" title=\"IntegratedMeshLayer的使用\"></a>IntegratedMeshLayer的使用</h3><p>这里使用的SLPK数据类型为倾斜摄影测量的成果，机密集格网，对应的图层类型IntegratedMeshLayer。<br>代码如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">require([&quot;esri&#x2F;Map&quot;, \n     &quot;esri&#x2F;views&#x2F;SceneView&quot;,\n     &quot;esri&#x2F;layers&#x2F;IntegratedMeshLayer&quot;,\n     &quot;esri&#x2F;geometry&#x2F;Extent&quot;\n   ], function(Map, SceneView,IntegratedMeshLayer,Extent) &#123;\n       var layer &#x3D; new IntegratedMeshLayer(&#123;\n         url:&quot;&quot;\n       &#125;);\n       var map &#x3D; new Map(&#123;\n         basemap: &quot;streets&quot;,\n         layers: [layer],\n         ground: &quot;world-elevation&quot;\n       &#125;);\n       var view &#x3D; new SceneView(&#123;\n         container: &quot;viewDiv&quot;, &#x2F;&#x2F; Reference to the scene div created in step 5\n         map: map, &#x2F;&#x2F; Reference to the map object created before the scene\n     &#125;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>官方实例：<a href=\"https://developers.arcgis.com/javascript/latest/sample-code/sandbox/index.html?sample=layers-integratedmeshlayer\">https://developers.arcgis.com/javascript/latest/sample-code/sandbox/index.html?sample=layers-integratedmeshlayer</a><br>其中IntegratedMeshLayer的url即为slpk所在目录，可以使用Nginx做反向代理</p>\n<h3 id=\"Nginx跨域配置\"><a href=\"#Nginx跨域配置\" class=\"headerlink\" title=\"Nginx跨域配置\"></a>Nginx跨域配置</h3><p>location节点内添加如下内容</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">location &#x2F;&#123;\n\t\t\n\t\t\tadd_header Access-Control-Allow-Origin *;\n\t\t\tadd_header Access-Control-Allow-Methods &#39;GET, POST, OPTIONS&#39;;\n\t\t\tadd_header Access-Control-Allow-Headers &#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#39;;\n\t\t&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"slpk数据中-json文件访问不到的问题\"><a href=\"#slpk数据中-json文件访问不到的问题\" class=\"headerlink\" title=\"slpk数据中.json文件访问不到的问题\"></a>slpk数据中.json文件访问不到的问题</h3><p>可在nginx中设置默认文件，添加如下部分：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">index 3dNodeIndexDocument.json 3dSceneLayer.json sharedResource.json 1_0.bin 0.bin 0.json;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"featurs、geometry、textures中的bin文件访问不到\"><a href=\"#featurs、geometry、textures中的bin文件访问不到\" class=\"headerlink\" title=\"featurs、geometry、textures中的bin文件访问不到\"></a>featurs、geometry、textures中的bin文件访问不到</h3><p>这里以features为例，在每个features内根据文件名创建同名目录，然后把文件复制进入即可，如旧目录结构如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">features\n  0.json<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>修改后的目录结构为：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">features\n  0\n    0.json<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>这里可自行写文件批量处理工具。</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.sohu.com/a/192789888_609577\">1、重磅：Esri-I3S标准规范将作为OGC新的国际三维标准 </a><br><a href=\"https://www.cnblogs.com/oukele/p/11003307.html\">2、Java实现复制文件或者文件夹</a><br><a href=\"https://www.cnblogs.com/jianmingyuan/p/10899917.html\">3、Windows下Nginx的启动、停止、重启等命令</a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c72a6dad\">3、封面图</a></p>","categories":[{"name":"GIS","path":"api/categories/GIS.json"}],"tags":[{"name":"GIS","path":"api/tags/GIS.json"}]}