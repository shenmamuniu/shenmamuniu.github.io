{"title":"CentOS7安装MariaDB","slug":"90","date":"2021-04-20T08:32:52.000Z","updated":"2021-04-20T08:32:52.000Z","comments":true,"path":"api/articles/90.json","realPath":null,"excerpt":"最近在做数据迁移，顺便把mysql替换为mariadb.","covers":null,"cover":null,"content":"<p>最近在做数据迁移，顺便把mysql替换为mariadb.</p>\n<span id=\"more\"></span>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><p>OS:centos 7.6<br>Mariadb：10.5.9</p>\n<p><strong>提示</strong>:关于mariadb的安装，网上有太多乱七八糟的教程了，最好的办法还是参考mariadb官网文档。</p>\n<h2 id=\"软件下载\"><a href=\"#软件下载\" class=\"headerlink\" title=\"软件下载\"></a>软件下载</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">wget https:&#x2F;&#x2F;mirrors.cloud.tencent.com&#x2F;mariadb&#x2F;mariadb-10.5.9&#x2F;bintar-linux-systemd-x86_64&#x2F;mariadb-10.5.9-linux-systemd-x86_64.tar.gz<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"删除已安装的mysql-or-mariadb\"><a href=\"#删除已安装的mysql-or-mariadb\" class=\"headerlink\" title=\"删除已安装的mysql or mariadb\"></a>删除已安装的mysql or mariadb</h2><p>这里不仅需要移除mariadb，如果有mysql,也要移除</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">rpm -qa | grep mariadb\nrpm -ev mariadb-libs-5.5.68-1.el7.x86_64 --nodeps\nfind &#x2F; -name mysql # 删除查询出来的文件夹<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"创建用户和组\"><a href=\"#创建用户和组\" class=\"headerlink\" title=\"创建用户和组\"></a>创建用户和组</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">groupadd mysql\nuseradd -r -g mysql mysql\nchown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"创建数据目录\"><a href=\"#创建数据目录\" class=\"headerlink\" title=\"创建数据目录\"></a>创建数据目录</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">chown -R mysql:mysql &#x2F;opt&#x2F;data&#x2F;mariadb<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"配置数据库的配置文件\"><a href=\"#配置数据库的配置文件\" class=\"headerlink\" title=\"配置数据库的配置文件\"></a>配置数据库的配置文件</h2><p>mariadb默认使用的配置文件&#x2F;etc&#x2F;my.cnf</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">[client]\nport &#x3D; 3306\nsocket &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysqld.sock\n\n# The MySQL server\n[mysqld]\nport &#x3D; 3306\nsocket &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysqld.sock\ndatadir &#x3D; &#x2F;opt&#x2F;data&#x2F;mariadb\nskip-external-locking\nskip-name-resolve\nback_log &#x3D; 50\nmax_connections &#x3D; 2048\nmax_connect_errors &#x3D; 1000\ntable_open_cache &#x3D; 1024\nopen_files_limit &#x3D; 16384\nmax_allowed_packet &#x3D; 16M\nread_buffer_size &#x3D; 8M\nread_rnd_buffer_size &#x3D; 32M\nsort_buffer_size &#x3D; 2M\njoin_buffer_size &#x3D; 2M\nthread_cache_size &#x3D; 64\nquery_cache_size &#x3D; 64M\nquery_cache_limit &#x3D; 4M\nslow_query_log &#x3D; 1\nlong_query_time &#x3D; 2\nlower_case_table_names &#x3D; 1\ninnodb_file_per_table &#x3D; 1\nmax_allowed_packet &#x3D; 1G\nserver-id &#x3D; 1\nlog-bin &#x3D; mysql-bin\nexpire_logs_days &#x3D; 7\nbinlog_format &#x3D; ROW\n\ninnodb_data_file_path &#x3D; ibdata1:12M:autoextend\ninnodb_buffer_pool_size &#x3D; 2G\ninnodb_write_io_threads &#x3D; 12\ninnodb_read_io_threads &#x3D; 8\ninnodb_thread_concurrency &#x3D; 16\ninnodb_flush_log_at_trx_commit &#x3D; 2\ninnodb_log_buffer_size &#x3D; 16M\ninnodb_log_file_size &#x3D; 170M\ninnodb_lock_wait_timeout &#x3D; 60\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"数据库初始化\"><a href=\"#数据库初始化\" class=\"headerlink\" title=\"数据库初始化\"></a>数据库初始化</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;scripts&#x2F;mysql_install_db --user&#x3D;mysql\n\n# 启动\n.&#x2F;bin&#x2F;mysqld_safe --user&#x3D;mysql &amp;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"配置开机启动\"><a href=\"#配置开机启动\" class=\"headerlink\" title=\"配置开机启动\"></a>配置开机启动</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">cp &#x2F;usr&#x2F;local&#x2F;msyql&#x2F;support-files&#x2F;mysql.server &#x2F;etc&#x2F;init.d&#x2F;mysql\nchmod 755 &#x2F;etc&#x2F;init.d&#x2F;mysql\nchkconfig --add mysql\nchkconfig --level 345 mysql on<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"设置环境变量\"><a href=\"#设置环境变量\" class=\"headerlink\" title=\"设置环境变量\"></a>设置环境变量</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin:$PATH<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>service mysql start&#x2F;restart</p>\n<h2 id=\"设置用户\"><a href=\"#设置用户\" class=\"headerlink\" title=\"设置用户\"></a>设置用户</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt;grant all privileges on *.* to &#39;root&#39;@&#39;%&#39; identified by &#39;root&#39; WITH GRANT OPTION;;\nmysql&gt;flush privileges;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>这里注意添加with grant option，通过update会提示没有权限.<br>到这一步，就可以通过mysql client连接数据库了。</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://cloud.tencent.com/developer/article/1720967\">1、CentOS7挂载新数据盘的完整步骤</a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c7247e32\">2、封面图</a></p>\n","more":"<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><p>OS:centos 7.6<br>Mariadb：10.5.9</p>\n<p><strong>提示</strong>:关于mariadb的安装，网上有太多乱七八糟的教程了，最好的办法还是参考mariadb官网文档。</p>\n<h2 id=\"软件下载\"><a href=\"#软件下载\" class=\"headerlink\" title=\"软件下载\"></a>软件下载</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">wget https:&#x2F;&#x2F;mirrors.cloud.tencent.com&#x2F;mariadb&#x2F;mariadb-10.5.9&#x2F;bintar-linux-systemd-x86_64&#x2F;mariadb-10.5.9-linux-systemd-x86_64.tar.gz<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"删除已安装的mysql-or-mariadb\"><a href=\"#删除已安装的mysql-or-mariadb\" class=\"headerlink\" title=\"删除已安装的mysql or mariadb\"></a>删除已安装的mysql or mariadb</h2><p>这里不仅需要移除mariadb，如果有mysql,也要移除</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">rpm -qa | grep mariadb\nrpm -ev mariadb-libs-5.5.68-1.el7.x86_64 --nodeps\nfind &#x2F; -name mysql # 删除查询出来的文件夹<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"创建用户和组\"><a href=\"#创建用户和组\" class=\"headerlink\" title=\"创建用户和组\"></a>创建用户和组</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">groupadd mysql\nuseradd -r -g mysql mysql\nchown -R mysql:mysql &#x2F;usr&#x2F;local&#x2F;mysql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"创建数据目录\"><a href=\"#创建数据目录\" class=\"headerlink\" title=\"创建数据目录\"></a>创建数据目录</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">chown -R mysql:mysql &#x2F;opt&#x2F;data&#x2F;mariadb<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"配置数据库的配置文件\"><a href=\"#配置数据库的配置文件\" class=\"headerlink\" title=\"配置数据库的配置文件\"></a>配置数据库的配置文件</h2><p>mariadb默认使用的配置文件&#x2F;etc&#x2F;my.cnf</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">[client]\nport &#x3D; 3306\nsocket &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysqld.sock\n\n# The MySQL server\n[mysqld]\nport &#x3D; 3306\nsocket &#x3D; &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysqld.sock\ndatadir &#x3D; &#x2F;opt&#x2F;data&#x2F;mariadb\nskip-external-locking\nskip-name-resolve\nback_log &#x3D; 50\nmax_connections &#x3D; 2048\nmax_connect_errors &#x3D; 1000\ntable_open_cache &#x3D; 1024\nopen_files_limit &#x3D; 16384\nmax_allowed_packet &#x3D; 16M\nread_buffer_size &#x3D; 8M\nread_rnd_buffer_size &#x3D; 32M\nsort_buffer_size &#x3D; 2M\njoin_buffer_size &#x3D; 2M\nthread_cache_size &#x3D; 64\nquery_cache_size &#x3D; 64M\nquery_cache_limit &#x3D; 4M\nslow_query_log &#x3D; 1\nlong_query_time &#x3D; 2\nlower_case_table_names &#x3D; 1\ninnodb_file_per_table &#x3D; 1\nmax_allowed_packet &#x3D; 1G\nserver-id &#x3D; 1\nlog-bin &#x3D; mysql-bin\nexpire_logs_days &#x3D; 7\nbinlog_format &#x3D; ROW\n\ninnodb_data_file_path &#x3D; ibdata1:12M:autoextend\ninnodb_buffer_pool_size &#x3D; 2G\ninnodb_write_io_threads &#x3D; 12\ninnodb_read_io_threads &#x3D; 8\ninnodb_thread_concurrency &#x3D; 16\ninnodb_flush_log_at_trx_commit &#x3D; 2\ninnodb_log_buffer_size &#x3D; 16M\ninnodb_log_file_size &#x3D; 170M\ninnodb_lock_wait_timeout &#x3D; 60\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"数据库初始化\"><a href=\"#数据库初始化\" class=\"headerlink\" title=\"数据库初始化\"></a>数据库初始化</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;scripts&#x2F;mysql_install_db --user&#x3D;mysql\n\n# 启动\n.&#x2F;bin&#x2F;mysqld_safe --user&#x3D;mysql &amp;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"配置开机启动\"><a href=\"#配置开机启动\" class=\"headerlink\" title=\"配置开机启动\"></a>配置开机启动</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">cp &#x2F;usr&#x2F;local&#x2F;msyql&#x2F;support-files&#x2F;mysql.server &#x2F;etc&#x2F;init.d&#x2F;mysql\nchmod 755 &#x2F;etc&#x2F;init.d&#x2F;mysql\nchkconfig --add mysql\nchkconfig --level 345 mysql on<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"设置环境变量\"><a href=\"#设置环境变量\" class=\"headerlink\" title=\"设置环境变量\"></a>设置环境变量</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">export PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin:$PATH<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>service mysql start&#x2F;restart</p>\n<h2 id=\"设置用户\"><a href=\"#设置用户\" class=\"headerlink\" title=\"设置用户\"></a>设置用户</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">mysql&gt;grant all privileges on *.* to &#39;root&#39;@&#39;%&#39; identified by &#39;root&#39; WITH GRANT OPTION;;\nmysql&gt;flush privileges;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>这里注意添加with grant option，通过update会提示没有权限.<br>到这一步，就可以通过mysql client连接数据库了。</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://cloud.tencent.com/developer/article/1720967\">1、CentOS7挂载新数据盘的完整步骤</a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c7247e32\">2、封面图</a></p>","categories":[{"name":"数据库","path":"api/categories/数据库.json"}],"tags":[{"name":"MariaDB","path":"api/tags/MariaDB.json"}]}