{"title":"Cesium编辑并保存Entity","slug":"Cesium编辑并保存Entity","date":"2022-11-03T12:54:38.000Z","updated":"2022-11-05T03:50:01.363Z","comments":true,"path":"api/articles/Cesium编辑并保存Entity.json","realPath":null,"excerpt":"这里借助Cesium的exportKml方法，先将Entity转为xml字符串，然后借助mapbox的togeojson将kml转为geojson,从而实现Entity数据的保存。","covers":null,"cover":null,"content":"<p>这里借助Cesium的exportKml方法，先将Entity转为xml字符串，然后借助mapbox的togeojson将kml转为geojson,从而实现Entity数据的保存。</p>\n<span id=\"more\"></span>\n\n\n\n<h2 id=\"Cesium编辑Entity\"><a href=\"#Cesium编辑Entity\" class=\"headerlink\" title=\"Cesium编辑Entity\"></a>Cesium编辑Entity</h2><p>可参考<a href=\"http://support.supermap.com.cn:8090/webgl/examples/webgl/editor.html#DrawAndEdit\">绘制编辑线面</a></p>\n<h2 id=\"Cesium将Entity转为kml\"><a href=\"#Cesium将Entity转为kml\" class=\"headerlink\" title=\"Cesium将Entity转为kml\"></a>Cesium将Entity转为kml</h2><p>参考<a href=\"http://cesium.xin/cesium/cn/Documentation1.62/exportKml.html\">exportKml</a>:</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> entities <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cesium<span class=\"token punctuation\">.</span>EntityCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nentities<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//其中x为Entity</span>\nCesium<span class=\"token punctuation\">.</span><span class=\"token function\">exportKml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n     <span class=\"token literal-property property\">entities</span><span class=\"token operator\">:</span> entityCollection\n <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">var</span> xmlStr<span class=\"token operator\">=</span>result<span class=\"token punctuation\">.</span>kml<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"kml转geojson\"><a href=\"#kml转geojson\" class=\"headerlink\" title=\"kml转geojson\"></a>kml转geojson</h2><p>使用<a href=\"https://github.com/mapbox/togeojson\">togeojson</a>可将kml转为geojson,如下:</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">'togeojson.js'</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n$<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test/data/linestring.kml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">xml</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>toGeoJSON<span class=\"token punctuation\">.</span><span class=\"token function\">kml</span><span class=\"token punctuation\">(</span>xml<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>如果拿到的是xml的字符串形式，即：</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">\"<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>xml</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>xml</span><span class=\"token punctuation\">></span></span>\"<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>需要先将xml字符串格式化，再调用toGeoJSON.kml函数:</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> dom <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseFromString</span><span class=\"token punctuation\">(</span>xmlStr<span class=\"token punctuation\">,</span> <span class=\"token string\">'text/xml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","more":"<h2 id=\"Cesium编辑Entity\"><a href=\"#Cesium编辑Entity\" class=\"headerlink\" title=\"Cesium编辑Entity\"></a>Cesium编辑Entity</h2><p>可参考<a href=\"http://support.supermap.com.cn:8090/webgl/examples/webgl/editor.html#DrawAndEdit\">绘制编辑线面</a></p>\n<h2 id=\"Cesium将Entity转为kml\"><a href=\"#Cesium将Entity转为kml\" class=\"headerlink\" title=\"Cesium将Entity转为kml\"></a>Cesium将Entity转为kml</h2><p>参考<a href=\"http://cesium.xin/cesium/cn/Documentation1.62/exportKml.html\">exportKml</a>:</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> entities <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cesium<span class=\"token punctuation\">.</span>EntityCollection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nentities<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//其中x为Entity</span>\nCesium<span class=\"token punctuation\">.</span><span class=\"token function\">exportKml</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n     <span class=\"token literal-property property\">entities</span><span class=\"token operator\">:</span> entityCollection\n <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">var</span> xmlStr<span class=\"token operator\">=</span>result<span class=\"token punctuation\">.</span>kml<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"kml转geojson\"><a href=\"#kml转geojson\" class=\"headerlink\" title=\"kml转geojson\"></a>kml转geojson</h2><p>使用<a href=\"https://github.com/mapbox/togeojson\">togeojson</a>可将kml转为geojson,如下:</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">'togeojson.js'</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n$<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test/data/linestring.kml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">xml</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>toGeoJSON<span class=\"token punctuation\">.</span><span class=\"token function\">kml</span><span class=\"token punctuation\">(</span>xml<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>如果拿到的是xml的字符串形式，即：</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">\"<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>xml</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>xml</span><span class=\"token punctuation\">></span></span>\"<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>需要先将xml字符串格式化，再调用toGeoJSON.kml函数:</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> dom <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseFromString</span><span class=\"token punctuation\">(</span>xmlStr<span class=\"token punctuation\">,</span> <span class=\"token string\">'text/xml'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","categories":[{"name":"Cesium","path":"api/categories/Cesium.json"}],"tags":[{"name":"Cesium","path":"api/tags/Cesium.json"},{"name":"KML","path":"api/tags/KML.json"},{"name":"Geojson","path":"api/tags/Geojson.json"}]}