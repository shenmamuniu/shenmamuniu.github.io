{"title":"Typecho使用pjax实现页面局部刷新","slug":"19","date":"2019-11-19T02:30:00.000Z","updated":"2019-11-27T14:13:54.000Z","comments":true,"path":"api/articles/19.json","excerpt":"在为博客加完音乐播放器之后，发现只要切换页面页面，整个页面都会重新加载，那有没有一种方法能够局部刷新页面呢？之前时ajax实现页面局部刷新，但代码比较繁琐，还要去考虑浏览器的兼容性等问题，于是就找到了一种新的方法，使用pjax。","covers":null,"content":"<p>在为博客加完音乐播放器之后，发现只要切换页面页面，整个页面都会重新加载，那有没有一种方法能够局部刷新页面呢？之前时ajax实现页面局部刷新，但代码比较繁琐，还要去考虑浏览器的兼容性等问题，于是就找到了一种新的方法，使用pjax。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"pjax介绍\"><a href=\"#pjax介绍\" class=\"headerlink\" title=\"pjax介绍\"></a>pjax介绍</h2><p>其利用ajax技术和Html5的pushstate,实现对页面的局部刷新,进而减少页面的请求数量，增强用户的体验效果。</p>\n<h2 id=\"pjax的引入及使用\"><a href=\"#pjax的引入及使用\" class=\"headerlink\" title=\"pjax的引入及使用\"></a>pjax的引入及使用</h2><h3 id=\"引入\"><a href=\"#引入\" class=\"headerlink\" title=\"引入\"></a>引入</h3><p>需要引入jquery和jquery.pjax.js两个文件，如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;script src&#x3D;&quot;&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery&#x2F;3.1.1&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;\n&lt;script src&#x3D;&quot;&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery.pjax&#x2F;2.0.1&#x2F;jquery.pjax.min.js&quot;&gt;&lt;&#x2F;script&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>这里注意下版本，如果使用jquery3.1,pjax1.x的版本是不可以的。</p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p>参数如下，具体可去<a href=\"https://github.com/defunkt/jquery-pjax\">query-ajax</a>查看：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$(document).pjax(selector, [container], options)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><strong>selector</strong> is a string to be used for click event delegation,如果有多个selector，可使用逗号隔开，如:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#39;.title-article a,.layui-nav-item a&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><strong>container</strong> is a string selector that uniquely identifies the pjax container,要刷新的区域；<br><strong>options</strong> is an object with keys。</p>\n<p>完整的实例如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$(document).pjax(&#39;.layui-laypage-molv a&#39;, &#123;\n        container: &#39;# pjax-container&#39;,\n        fragment: &#39;# pjax-container&#39;,\n        timeout: 8000\n    &#125;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时刷新页面，检查pjax是否起到了作用</p>\n<h2 id=\"使用Nprogress添加页面加载的进度条\"><a href=\"#使用Nprogress添加页面加载的进度条\" class=\"headerlink\" title=\"使用Nprogress添加页面加载的进度条\"></a>使用Nprogress添加页面加载的进度条</h2><p>引入Nprogress</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;link href&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;nprogress&#x2F;0.2.0&#x2F;nprogress.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;\n&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;nprogress&#x2F;0.2.0&#x2F;nprogress.min.js&quot;&gt;&lt;&#x2F;script&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>配置Pjax使用，如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$(document).on(&#39;pjax:start&#39;, NProgress.start).on(&#39;pjax:end&#39;, NProgress.done)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"其他的问题\"><a href=\"#其他的问题\" class=\"headerlink\" title=\"其他的问题\"></a>其他的问题</h2><h3 id=\"目录读取不到内容\"><a href=\"#目录读取不到内容\" class=\"headerlink\" title=\"目录读取不到内容\"></a>目录读取不到内容</h3><p>本站的目录是根据文章的内容来加载的，因此只有在内容加载完成之后才能获取到文章的内容，所以需要在pjax：end中重新加载，如下</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$(document).on(&#39;ready pjax:end&#39;,function()&#123;\n        GenerateContentList();\n&#125;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>关于目录的生成请查看<a href=\"https://qqdie.com/archives/js-index.html\">js为博客文章自动生成目录</a></p>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><p><a href=\"https://www.ihewro.com/archives/354/\">1、typecho博客实现pjax</a><br><a href=\"http://xiaoxiyuashu.lofter.com/post/1d088eab_1c70b8c32\">2、封面图</a></p>\n","more":"<h2 id=\"pjax介绍\"><a href=\"#pjax介绍\" class=\"headerlink\" title=\"pjax介绍\"></a>pjax介绍</h2><p>其利用ajax技术和Html5的pushstate,实现对页面的局部刷新,进而减少页面的请求数量，增强用户的体验效果。</p>\n<h2 id=\"pjax的引入及使用\"><a href=\"#pjax的引入及使用\" class=\"headerlink\" title=\"pjax的引入及使用\"></a>pjax的引入及使用</h2><h3 id=\"引入\"><a href=\"#引入\" class=\"headerlink\" title=\"引入\"></a>引入</h3><p>需要引入jquery和jquery.pjax.js两个文件，如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;script src&#x3D;&quot;&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery&#x2F;3.1.1&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;\n&lt;script src&#x3D;&quot;&#x2F;&#x2F;cdn.bootcss.com&#x2F;jquery.pjax&#x2F;2.0.1&#x2F;jquery.pjax.min.js&quot;&gt;&lt;&#x2F;script&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>这里注意下版本，如果使用jquery3.1,pjax1.x的版本是不可以的。</p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p>参数如下，具体可去<a href=\"https://github.com/defunkt/jquery-pjax\">query-ajax</a>查看：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$(document).pjax(selector, [container], options)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><strong>selector</strong> is a string to be used for click event delegation,如果有多个selector，可使用逗号隔开，如:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#39;.title-article a,.layui-nav-item a&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><strong>container</strong> is a string selector that uniquely identifies the pjax container,要刷新的区域；<br><strong>options</strong> is an object with keys。</p>\n<p>完整的实例如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$(document).pjax(&#39;.layui-laypage-molv a&#39;, &#123;\n        container: &#39;# pjax-container&#39;,\n        fragment: &#39;# pjax-container&#39;,\n        timeout: 8000\n    &#125;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>此时刷新页面，检查pjax是否起到了作用</p>\n<h2 id=\"使用Nprogress添加页面加载的进度条\"><a href=\"#使用Nprogress添加页面加载的进度条\" class=\"headerlink\" title=\"使用Nprogress添加页面加载的进度条\"></a>使用Nprogress添加页面加载的进度条</h2><p>引入Nprogress</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;link href&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;nprogress&#x2F;0.2.0&#x2F;nprogress.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;\n&lt;script src&#x3D;&quot;https:&#x2F;&#x2F;cdn.bootcss.com&#x2F;nprogress&#x2F;0.2.0&#x2F;nprogress.min.js&quot;&gt;&lt;&#x2F;script&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>配置Pjax使用，如下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$(document).on(&#39;pjax:start&#39;, NProgress.start).on(&#39;pjax:end&#39;, NProgress.done)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"其他的问题\"><a href=\"#其他的问题\" class=\"headerlink\" title=\"其他的问题\"></a>其他的问题</h2><h3 id=\"目录读取不到内容\"><a href=\"#目录读取不到内容\" class=\"headerlink\" title=\"目录读取不到内容\"></a>目录读取不到内容</h3><p>本站的目录是根据文章的内容来加载的，因此只有在内容加载完成之后才能获取到文章的内容，所以需要在pjax：end中重新加载，如下</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">$(document).on(&#39;ready pjax:end&#39;,function()&#123;\n        GenerateContentList();\n&#125;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>关于目录的生成请查看<a href=\"https://qqdie.com/archives/js-index.html\">js为博客文章自动生成目录</a></p>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><p><a href=\"https://www.ihewro.com/archives/354/\">1、typecho博客实现pjax</a><br><a href=\"http://xiaoxiyuashu.lofter.com/post/1d088eab_1c70b8c32\">2、封面图</a></p>","categories":[{"name":"Typecho","path":"api/categories/Typecho.json"}],"tags":[{"name":"typecho","path":"api/tags/typecho.json"}]}