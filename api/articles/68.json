{"title":"Nginx为ArcServer做反向代理","slug":"68","date":"2020-07-31T06:53:00.000Z","updated":"2020-07-31T06:54:47.000Z","comments":true,"path":"api/articles/68.json","excerpt":"通过使用Nginx中的ngx_http_access_module,来为我们的ArcServer保驾护航,实现只允许特定的IP可以访问我们的ArcServer发布的服务。","covers":null,"content":"<p>通过使用Nginx中的ngx_http_access_module,来为我们的ArcServer保驾护航,实现只允许特定的IP可以访问我们的ArcServer发布的服务。</p>\n<span id=\"more\"></span>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><p>ArcServer:10.2<br>Nginx:1.19.1<br>OS:windows server 2008 R2</p>\n<h2 id=\"调整ArcServer的端口\"><a href=\"#调整ArcServer的端口\" class=\"headerlink\" title=\"调整ArcServer的端口\"></a>调整ArcServer的端口</h2><p>调整之前，先停止ArcServer服务。<br>ArcServer10.2的manager是部署在tomcat中提供服务的，首先需要调整tomcat的端口，tomcat位于：C:\\Program Files\\ArcGIS\\Server\\framework\\runtime,打开conf&#x2F;server.xml：<br>将其中的默认端口6080调整为需要的端口，如6090。</p>\n<p>然后还要修改arcgisserver\\config-store\\machines下的一个*.json文件，文件名和主机名是一致的，将其中的6080调整为上面修改的端口号：6090即可。</p>\n<p>重启ArcServer服务，如果<a href=\"http://localhost:6090/arcgis/manager%E8%AE%BF%E9%97%AE%E6%B2%A1%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C%E9%82%A3%E8%AF%B4%E6%98%8E%E8%B0%83%E6%95%B4%E6%88%90%E5%8A%9F%E3%80%82\">http://localhost:6090/arcgis/manager访问没有问题，那说明调整成功。</a></p>\n<h2 id=\"Nginx配置反向代理\"><a href=\"#Nginx配置反向代理\" class=\"headerlink\" title=\"Nginx配置反向代理\"></a>Nginx配置反向代理</h2><p>修改nginx.conf文件，添加如下内容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;\n    ...\n    server &#123;\n        listen 6080;\n        location &#x2F;&#123;\n            proxy_pass http:&#x2F;&#x2F;host:6090;\n        &#125;\n\n    &#125;\n    ...\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>windows下启动Nginx:start nginx.exe</p>\n<p>此时如果通过6080端口能够正常访问ArcServer则证明没有问题。</p>\n<h2 id=\"Nginx配置指定的IP访问\"><a href=\"#Nginx配置指定的IP访问\" class=\"headerlink\" title=\"Nginx配置指定的IP访问\"></a>Nginx配置指定的IP访问</h2><p>以下包含局部配置和全局配置，可根据实际情况选择。</p>\n<h3 id=\"在location下配置-局部配置\"><a href=\"#在location下配置-局部配置\" class=\"headerlink\" title=\"在location下配置[局部配置]\"></a>在location下配置[局部配置]</h3><p>如:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;\n    location &#x2F;&#123;\n        ...\n\n        allow 192.168.10.111;\n        deny all;\n    &#125;\n\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这样配置就仅针对当前server的location,非整个Nginx.</p>\n<h3 id=\"全局配置\"><a href=\"#全局配置\" class=\"headerlink\" title=\"全局配置\"></a>全局配置</h3><p>创建一个blockips.conf文件，里面加入如下内容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">allow 192.168.10.111;\ndeny all;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>在nginx.conf文件的http节点的末尾加入如下内容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">include blockips.conf;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>这样针对的就是整个Nginx。</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.cnblogs.com/yyxianren/p/10837189.html\">1. nginx 访问控制之deny allow</a><br><a href=\"https://www.cnblogs.com/tiandi/p/5967929.html\">2. Arcgis Server 默认服务端口号修改方法</a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c71e6ba8\">3. 封面图源</a></p>\n","more":"<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><p>ArcServer:10.2<br>Nginx:1.19.1<br>OS:windows server 2008 R2</p>\n<h2 id=\"调整ArcServer的端口\"><a href=\"#调整ArcServer的端口\" class=\"headerlink\" title=\"调整ArcServer的端口\"></a>调整ArcServer的端口</h2><p>调整之前，先停止ArcServer服务。<br>ArcServer10.2的manager是部署在tomcat中提供服务的，首先需要调整tomcat的端口，tomcat位于：C:\\Program Files\\ArcGIS\\Server\\framework\\runtime,打开conf&#x2F;server.xml：<br>将其中的默认端口6080调整为需要的端口，如6090。</p>\n<p>然后还要修改arcgisserver\\config-store\\machines下的一个*.json文件，文件名和主机名是一致的，将其中的6080调整为上面修改的端口号：6090即可。</p>\n<p>重启ArcServer服务，如果<a href=\"http://localhost:6090/arcgis/manager%E8%AE%BF%E9%97%AE%E6%B2%A1%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C%E9%82%A3%E8%AF%B4%E6%98%8E%E8%B0%83%E6%95%B4%E6%88%90%E5%8A%9F%E3%80%82\">http://localhost:6090/arcgis/manager访问没有问题，那说明调整成功。</a></p>\n<h2 id=\"Nginx配置反向代理\"><a href=\"#Nginx配置反向代理\" class=\"headerlink\" title=\"Nginx配置反向代理\"></a>Nginx配置反向代理</h2><p>修改nginx.conf文件，添加如下内容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;\n    ...\n    server &#123;\n        listen 6080;\n        location &#x2F;&#123;\n            proxy_pass http:&#x2F;&#x2F;host:6090;\n        &#125;\n\n    &#125;\n    ...\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>windows下启动Nginx:start nginx.exe</p>\n<p>此时如果通过6080端口能够正常访问ArcServer则证明没有问题。</p>\n<h2 id=\"Nginx配置指定的IP访问\"><a href=\"#Nginx配置指定的IP访问\" class=\"headerlink\" title=\"Nginx配置指定的IP访问\"></a>Nginx配置指定的IP访问</h2><p>以下包含局部配置和全局配置，可根据实际情况选择。</p>\n<h3 id=\"在location下配置-局部配置\"><a href=\"#在location下配置-局部配置\" class=\"headerlink\" title=\"在location下配置[局部配置]\"></a>在location下配置[局部配置]</h3><p>如:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;\n    location &#x2F;&#123;\n        ...\n\n        allow 192.168.10.111;\n        deny all;\n    &#125;\n\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这样配置就仅针对当前server的location,非整个Nginx.</p>\n<h3 id=\"全局配置\"><a href=\"#全局配置\" class=\"headerlink\" title=\"全局配置\"></a>全局配置</h3><p>创建一个blockips.conf文件，里面加入如下内容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">allow 192.168.10.111;\ndeny all;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>在nginx.conf文件的http节点的末尾加入如下内容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">include blockips.conf;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>这样针对的就是整个Nginx。</p>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://www.cnblogs.com/yyxianren/p/10837189.html\">1. nginx 访问控制之deny allow</a><br><a href=\"https://www.cnblogs.com/tiandi/p/5967929.html\">2. Arcgis Server 默认服务端口号修改方法</a><br><a href=\"https://huadou145.lofter.com/post/205d4db3_1c71e6ba8\">3. 封面图源</a></p>","categories":[{"name":"GIS","path":"api/categories/GIS.json"}],"tags":[{"name":"Nginx","path":"api/tags/Nginx.json"},{"name":"GIS","path":"api/tags/GIS.json"},{"name":"ArcServer","path":"api/tags/ArcServer.json"}]}