{"title":"Nginx結合http-flv模塊搭建視頻推流服務","slug":"96","date":"2021-04-27T13:45:18.000Z","updated":"2021-04-27T13:45:18.000Z","comments":true,"path":"api/articles/96.json","realPath":null,"excerpt":"明明之前在centos上使用Nginx搭建視頻推流服務很順利，結果在Ubuntu上差點翻車，於是把遇到的問題簡單記錄一下。","covers":null,"cover":null,"content":"<p>明明之前在centos上使用Nginx搭建視頻推流服務很順利，結果在Ubuntu上差點翻車，於是把遇到的問題簡單記錄一下。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"應用環境\"><a href=\"#應用環境\" class=\"headerlink\" title=\"應用環境\"></a>應用環境</h2><p>OS:Ubuntu 18.04<br>Nginx:1.20.0<br>http-flv:1.2.9</p>\n<h2 id=\"Nginx配置\"><a href=\"#Nginx配置\" class=\"headerlink\" title=\"Nginx配置\"></a>Nginx配置</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure --add-module&#x3D;nginx-http-flv-module-1.2.9<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>可能會提示缺少zlib、pcre、openssl：<br>對於zlib，這裏直接在其官網上下載zlib-1.2.11.tar.gz進行安裝</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure\nmake\nmake install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>至於openssl,可通過以下命令安裝:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">apt install openssl\napt install libssl-dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>由於視頻推流不需要依賴pcre模塊的http-rewrite模塊，因此:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure --add-module&#x3D;nginx-http-flv-module-1.2.9 --without-http_rewrite_module<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>這裏也附上centos下這幾個包的安裝：<br>yum install zlib zlib-devel<br>yum install pcre pcre-devel<br>yum install openssl openssl-devel </p>\n</blockquote>\n<h2 id=\"Nginx安裝\"><a href=\"#Nginx安裝\" class=\"headerlink\" title=\"Nginx安裝\"></a>Nginx安裝</h2><p>執行以下命令進行安裝：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">make\nmake install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>這樣Nginx1.20就被安裝在了&#x2F;usr&#x2F;local&#x2F;nginx下，如果之前有安裝舊版本的Nginx，且Nginx是通過apt進行安裝的，需要把&#x2F;usr&#x2F;sbin下面的nginx刪掉或改爲其它名字，然後修改環境變量：<br>vi &#x2F;etc&#x2F;profile<br>添加如下內容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>執行以下命令更新：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">source &#x2F;etc&#x2F;profile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>此時可以通過nginx -v查看Nginx是否生效。</p>\n<h2 id=\"配置rtmp\"><a href=\"#配置rtmp\" class=\"headerlink\" title=\"配置rtmp\"></a>配置rtmp</h2><p>在http-flv模塊的<a href=\"https://github.com/winshining/nginx-http-flv-module\">github</a>上，有關於rtmp的詳細配置，可以直接參考。</p>\n<blockquote>\n<p>另：如果你不想這麼麻煩，那麼也可以使用<a href=\"https://monibuca.com/\">Monibuca</a>來部署視頻流服務器。</p>\n</blockquote>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://tiezhuzhuzhu923.lofter.com/post/310ff6d7_1c804cbfb\">1、封面图源</a></p>\n","more":"<h2 id=\"應用環境\"><a href=\"#應用環境\" class=\"headerlink\" title=\"應用環境\"></a>應用環境</h2><p>OS:Ubuntu 18.04<br>Nginx:1.20.0<br>http-flv:1.2.9</p>\n<h2 id=\"Nginx配置\"><a href=\"#Nginx配置\" class=\"headerlink\" title=\"Nginx配置\"></a>Nginx配置</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure --add-module&#x3D;nginx-http-flv-module-1.2.9<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>可能會提示缺少zlib、pcre、openssl：<br>對於zlib，這裏直接在其官網上下載zlib-1.2.11.tar.gz進行安裝</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure\nmake\nmake install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>至於openssl,可通過以下命令安裝:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">apt install openssl\napt install libssl-dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>由於視頻推流不需要依賴pcre模塊的http-rewrite模塊，因此:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure --add-module&#x3D;nginx-http-flv-module-1.2.9 --without-http_rewrite_module<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>這裏也附上centos下這幾個包的安裝：<br>yum install zlib zlib-devel<br>yum install pcre pcre-devel<br>yum install openssl openssl-devel </p>\n</blockquote>\n<h2 id=\"Nginx安裝\"><a href=\"#Nginx安裝\" class=\"headerlink\" title=\"Nginx安裝\"></a>Nginx安裝</h2><p>執行以下命令進行安裝：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">make\nmake install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>這樣Nginx1.20就被安裝在了&#x2F;usr&#x2F;local&#x2F;nginx下，如果之前有安裝舊版本的Nginx，且Nginx是通過apt進行安裝的，需要把&#x2F;usr&#x2F;sbin下面的nginx刪掉或改爲其它名字，然後修改環境變量：<br>vi &#x2F;etc&#x2F;profile<br>添加如下內容：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>執行以下命令更新：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">source &#x2F;etc&#x2F;profile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>此時可以通過nginx -v查看Nginx是否生效。</p>\n<h2 id=\"配置rtmp\"><a href=\"#配置rtmp\" class=\"headerlink\" title=\"配置rtmp\"></a>配置rtmp</h2><p>在http-flv模塊的<a href=\"https://github.com/winshining/nginx-http-flv-module\">github</a>上，有關於rtmp的詳細配置，可以直接參考。</p>\n<blockquote>\n<p>另：如果你不想這麼麻煩，那麼也可以使用<a href=\"https://monibuca.com/\">Monibuca</a>來部署視頻流服務器。</p>\n</blockquote>\n<h2 id=\"Referenced\"><a href=\"#Referenced\" class=\"headerlink\" title=\"Referenced\"></a>Referenced</h2><p><a href=\"https://tiezhuzhuzhu923.lofter.com/post/310ff6d7_1c804cbfb\">1、封面图源</a></p>","categories":[{"name":"运维","path":"api/categories/运维.json"}],"tags":[{"name":"Nginx","path":"api/tags/Nginx.json"},{"name":"RTMP","path":"api/tags/RTMP.json"},{"name":"推流","path":"api/tags/推流.json"}]}